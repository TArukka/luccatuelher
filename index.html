<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucca Tuelher | Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,700;1,300&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           DESIGN SYSTEM
           ======================================== */
        :root {
            --bg:        #F2EFE8;   /* Papel creme envelhecido */
            --bg2:       #E8E4DB;   /* Creme mais escuro */
            --ink:       #1C1B18;   /* Quase preto */
            --ink-soft:  #5A574F;   /* Cinza quente */
            --ink-pale:  #A09C93;   /* Cinza pálido */
            --rule:      #C8C4BB;   /* Linha de régua */
            --accent:    #C1440E;   /* Vermelho tijolo */
            --accent2:   #2D5A8E;   /* Azul cobalto */
            --white:     #FAFAF7;
            
            --serif:  'DM Serif Display', Georgia, serif;
            --sans:   'DM Sans', Helvetica, sans-serif;
            --mono:   'DM Mono', 'Courier New', monospace;
            
            --ease: cubic-bezier(0.25, 0.1, 0.25, 1);
            --ease-out: cubic-bezier(0.0, 0.0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }

        body {
            background: var(--bg);
            color: var(--ink);
            font-family: var(--sans);
            font-weight: 300;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        /* Bilíngue */
        body.lang-pt .en-only { display: none !important; }
        body.lang-en .pt-only { display: none !important; }
        .hidden { display: none !important; }

        /* ========================================
           GRAIN TEXTURE OVERLAY
           ======================================== */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            z-index: 9000;
            pointer-events: none;
            opacity: 0.018;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 256px 256px;
        }

        /* ========================================
           LAYOUT
           ======================================== */
        .container {
            width: min(70%, 1100px);
            min-width: 320px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* ========================================
           HEADER
           ======================================== */
        header {
            padding: 1.8rem 0 1.4rem;
            border-bottom: 1.5px solid var(--ink);
            margin-bottom: 0;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: end;
            gap: 20px;
        }

        .header-identity { }

        .header-name {
            font-family: var(--serif);
            font-size: clamp(2rem, 5vw, 3.2rem);
            font-weight: 400;
            letter-spacing: -0.02em;
            line-height: 1;
            color: var(--ink);
        }

        .header-role {
            font-family: var(--sans);
            font-size: 0.78rem;
            font-weight: 400;
            color: var(--ink-soft);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-top: 6px;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        /* Lang flags */
        .lang-icons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .flag-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.3;
            transition: opacity 0.2s;
            padding: 2px;
        }
        .flag-btn:hover { opacity: 0.7; }
        body.lang-pt .flag-btn[data-lang="pt"] { opacity: 1; }
        body.lang-en .flag-btn[data-lang="en"] { opacity: 1; }

        /* Nav */
        nav {
            display: flex;
            gap: 0;
            align-items: center;
        }

        .nav-link {
            font-family: var(--mono);
            font-size: 0.72rem;
            font-weight: 500;
            color: var(--ink-soft);
            text-decoration: none;
            cursor: pointer;
            padding: 6px 14px;
            border: 1px solid transparent;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            transition: all 0.2s var(--ease);
            user-select: none;
            white-space: nowrap;
        }

        .nav-link:hover {
            color: var(--ink);
            border-color: var(--rule);
        }

        .nav-link.active {
            color: var(--ink);
            border-color: var(--ink);
        }

        .nav-link.private-btn {
            color: var(--accent);
        }

        .nav-link.private-btn:hover {
            border-color: var(--accent);
        }

        /* ========================================
           ISSUE BAR (como uma publicação de revista)
           ======================================== */
        .issue-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--rule);
            margin-bottom: 0;
        }

        .issue-text {
            font-family: var(--mono);
            font-size: 0.65rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* ========================================
           SECTION TITLES
           ======================================== */
        .section-title {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 20px;
            margin: 80px 0 50px;
        }

        .section-label {
            font-family: var(--mono);
            font-size: 0.68rem;
            font-weight: 500;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--ink-soft);
            white-space: nowrap;
        }

        .section-rule {
            height: 1px;
            background: var(--rule);
        }

        .section-num {
            font-family: var(--mono);
            font-size: 0.65rem;
            color: var(--ink-pale);
        }

        /* ========================================
           BANNER HERO
           ======================================== */
        .banner-container {
            width: 100%;
            height: clamp(280px, 42vw, 460px);
            overflow: hidden;
            position: relative;
            background: var(--bg2);
            margin-bottom: 0;
        }

        .banner-container::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(28,27,24,0.55) 0%, rgba(28,27,24,0.1) 60%, transparent 100%);
            pointer-events: none;
        }

        .banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 8s var(--ease-out);
        }

        .banner-container:hover .banner-img {
            transform: scale(1.025);
        }

        .banner-text {
            position: absolute;
            bottom: 0;
            left: 0;
            padding: 40px 48px;
            z-index: 2;
            pointer-events: none;
        }

        .banner-label {
            font-family: var(--mono);
            font-size: 0.68rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(250,250,247,0.65);
            margin-bottom: 10px;
            pointer-events: all;
        }

        .banner-title {
            font-family: var(--serif);
            font-size: clamp(2.4rem, 6vw, 4rem);
            font-weight: 400;
            color: var(--white);
            line-height: 1;
            letter-spacing: -0.02em;
            pointer-events: all;
        }

        /* ========================================
           HOME YOUTUBE EMBED
           ======================================== */
        .home-yt-wrap {
            margin: 32px 0 0;
            position: relative;
        }

        /* ========================================
           HOME PROJECT SECTIONS — stacked full-width
           ======================================== */

        #featured-sections {
            margin-top: 0;
        }

        /* Each project = one block, full width, stacked */
        .home-proj-section {
            border-top: 1px solid var(--rule);
            padding: 52px 0;
            position: relative;
        }

        /* no border after last project section */

        /* Top row: just the text info, no grid needed */
        .hps-top {
            margin-bottom: 32px;
        }

        .hps-left { }

        .hps-index {
            font-family: var(--mono);
            font-size: 0.6rem;
            color: var(--ink-pale);
            letter-spacing: 0.15em;
            margin-bottom: 20px;
        }

        .hps-tag {
            font-family: var(--mono);
            font-size: 0.62rem;
            color: var(--accent);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .hps-title {
            font-family: var(--serif);
            font-size: clamp(2rem, 4vw, 3.2rem);
            font-weight: 400;
            line-height: 1.05;
            color: var(--ink);
            margin-bottom: 14px;
            letter-spacing: -0.02em;
        }

        .hps-subtitle {
            font-size: 1rem;
            color: var(--ink-soft);
            line-height: 1.65;
            font-style: italic;
            margin-bottom: 28px;
            max-width: 44ch;
        }

        .hps-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: var(--mono);
            font-size: 0.68rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--ink);
            text-decoration: none;
            border-bottom: 1px solid var(--ink);
            padding-bottom: 2px;
            transition: color 0.2s, border-color 0.2s;
            cursor: pointer;
            width: fit-content;
        }
        .hps-link:hover { color: var(--accent); border-color: var(--accent); }

        /* Main thumb — right column of top row */
        .hps-right {
            position: relative;
            overflow: hidden;
            aspect-ratio: 16/9;
            cursor: pointer;
            background: var(--bg2);
        }

        .hps-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.6s var(--ease-out);
            position: absolute;
            inset: 0;
        }

        .home-proj-section:hover .hps-thumb {
            transform: scale(1.025);
        }

        .hps-thumb-overlay {
            position: absolute;
            inset: 0;
            background: var(--accent);
            opacity: 0;
            mix-blend-mode: multiply;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .home-proj-section:hover .hps-thumb-overlay {
            opacity: 0.05;
        }

        /* SpeakerDeck embed */
        .hps-embed-wrap {
            position: relative;
            margin-bottom: 16px;
        }

        .hps-embed-label {
            font-family: var(--mono);
            font-size: 0.58rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--ink-pale);
            margin-bottom: 8px;
        }

        .hps-embed {
            width: 100%;
            background: var(--ink);
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .hps-embed iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            position: absolute;
            inset: 0;
        }

        .hps-embed-placeholder {
            font-family: var(--mono);
            font-size: 0.62rem;
            color: rgba(255,255,255,0.3);
            letter-spacing: 0.1em;
            text-align: center;
            padding: 20px;
        }

        /* 3 preview images */
        .hps-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 0;
        }

        .hps-img-item {
            position: relative;
            aspect-ratio: 4/3;
            overflow: hidden;
            background: var(--bg2);
            cursor: pointer;
        }

        .hps-img-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.4s var(--ease-out);
        }

        .hps-img-item:hover img { transform: scale(1.06); }

        /* Footer row with ver projeto link */
        .hps-footer {
            margin-top: 28px;
            padding-top: 20px;
            border-top: 1px solid var(--rule);
        }

        /* ========================================
           BOTTOM BANNER
           ======================================== */
        .bottom-banner {
            width: 100%;
            height: clamp(200px, 28vw, 320px);
            position: relative;
            overflow: hidden;
            margin-top: 90px;
            background: var(--ink);
            cursor: pointer;
        }

        .bottom-banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            filter: brightness(0.45);
            transition: transform 8s var(--ease-out), filter 0.4s;
        }

        .bottom-banner:hover .bottom-banner-img {
            transform: scale(1.025);
            filter: brightness(0.38);
        }

        .bottom-banner-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 2;
        }

        .bottom-banner-text {
            font-family: var(--serif);
            font-size: clamp(1.4rem, 3.5vw, 2.4rem);
            color: var(--white);
            font-weight: 400;
            text-align: center;
            letter-spacing: -0.01em;
            line-height: 1.1;
        }

        .bottom-banner-cta {
            font-family: var(--mono);
            font-size: 0.72rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: rgba(250,250,247,0.7);
            text-decoration: none;
            border-bottom: 1px solid rgba(250,250,247,0.4);
            padding-bottom: 3px;
            transition: color 0.2s, border-color 0.2s;
            cursor: pointer;
        }

        .bottom-banner-cta:hover { color: var(--white); border-color: var(--white); }

        /* VIDEO EMBED (used inside project detail pages) */
        .embed-wrapper {
            margin-bottom: 28px;
            position: relative;
        }

        .embed-area {
            width: 100%;
            background: var(--ink);
            position: relative;
            overflow: hidden;
        }

        .embed-area iframe {
            width: 100%;
            aspect-ratio: 16/9;
            display: block;
            border: none;
        }

        /* ========================================
           PROJECT GRID
           ======================================== */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 0;
        }

        .project-card {
            cursor: pointer;
            position: relative;
            group: true;
        }

        .card-thumb-wrap {
            width: 100%;
            aspect-ratio: 4/3;
            overflow: hidden;
            background: var(--bg2);
            margin-bottom: 14px;
            position: relative;
        }

        .card-thumb-wrap::after {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.3s var(--ease);
            mix-blend-mode: multiply;
        }

        .project-card:hover .card-thumb-wrap::after {
            opacity: 0.08;
        }

        .card-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.5s var(--ease-out);
        }

        .project-card:hover .card-thumb {
            transform: scale(1.04);
        }

        .card-tag {
            font-family: var(--mono);
            font-size: 0.62rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .card-title {
            font-family: var(--serif);
            font-size: 1.15rem;
            font-weight: 400;
            line-height: 1.2;
            color: var(--ink);
            transition: color 0.2s;
        }

        .project-card:hover .card-title {
            color: var(--accent);
        }

        .card-arrow {
            display: inline-block;
            margin-left: 6px;
            opacity: 0;
            transform: translateX(-4px);
            transition: all 0.2s var(--ease);
        }

        .project-card:hover .card-arrow {
            opacity: 1;
            transform: translateX(0);
        }

        /* ========================================
           SKETCHBOOK
           ======================================== */
        .sketch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 4rem;
            align-items: start;
        }

        .sketch-item {
            overflow: hidden;
            cursor: zoom-in;
            position: relative;
            background: var(--bg2);
        }

        .sketch-item img {
            width: 100%;
            height: auto;
            display: block;
            transition: filter 0.4s var(--ease);
            filter: grayscale(60%);
        }

        .sketch-item:hover img {
            filter: grayscale(0%);
        }

        /* ========================================
           BLOG / NOTES
           ======================================== */
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0;
            border-top: 1.5px solid var(--ink);
            margin-bottom: 4rem;
        }

        .blog-item {
            padding: 32px 24px 32px 0;
            border-bottom: 1px solid var(--rule);
            cursor: pointer;
            position: relative;
            transition: background 0.2s;
        }

        .blog-item:nth-child(even) {
            padding-left: 24px;
            padding-right: 0;
            border-left: 1px solid var(--rule);
        }

        .blog-item:hover {
            background: var(--bg2);
        }

        .blog-date {
            font-family: var(--mono);
            font-size: 0.65rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            display: block;
            margin-bottom: 12px;
        }

        .blog-thumb {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            display: block;
            background: var(--bg2);
            margin-bottom: 16px;
            transition: opacity 0.3s;
        }

        .blog-item:hover .blog-thumb { opacity: 0.9; }

        .blog-title {
            font-family: var(--serif);
            font-size: 1.4rem;
            font-weight: 400;
            line-height: 1.2;
            margin-bottom: 12px;
            color: var(--ink);
        }

        .blog-excerpt {
            font-size: 0.85rem;
            color: var(--ink-soft);
            line-height: 1.6;
            font-style: italic;
        }

        /* ========================================
           ART GALLERY
           ======================================== */
        .gallery-header {
            margin: 4rem 0 3rem;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: end;
            border-bottom: 1.5px solid var(--ink);
            padding-bottom: 20px;
        }

        .gallery-h1 {
            font-family: var(--serif);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 400;
            line-height: 1;
        }

        .gallery-sub {
            font-family: var(--mono);
            font-size: 0.7rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .art-gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            align-items: start;
            margin-bottom: 4rem;
        }

        .art-item {
            position: relative;
            break-inside: avoid;
        }

        .art-img {
            width: 100%;
            height: auto;
            display: block;
            background: var(--bg2);
            transition: opacity 0.3s;
        }

        .art-item:hover .art-img { opacity: 0.9; }

        .art-caption {
            font-family: var(--mono);
            font-size: 0.65rem;
            color: var(--ink-pale);
            letter-spacing: 0.08em;
            padding: 10px 0 0;
            text-transform: uppercase;
        }

        /* ========================================
           DETAIL VIEW
           ======================================== */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: var(--mono);
            font-size: 0.72rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--ink-soft);
            cursor: pointer;
            padding: 20px 0;
            transition: color 0.2s;
            user-select: none;
        }

        .back-btn:hover { color: var(--ink); }

        .detail-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .detail-header {
            border-bottom: 1.5px solid var(--ink);
            padding-bottom: 32px;
            margin-bottom: 10px;
        }

        .detail-tag {
            font-family: var(--mono);
            font-size: 0.68rem;
            color: var(--accent);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 16px;
        }

        .detail-title {
            font-family: var(--serif);
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 400;
            line-height: 1;
            margin-bottom: 20px;
            letter-spacing: -0.02em;
        }

        .detail-desc {
            font-size: 1.05rem;
            color: var(--ink-soft);
            font-style: italic;
            line-height: 1.7;
            max-width: 65ch;
        }

        .detail-meta {
            display: flex;
            gap: 32px;
            margin-top: 24px;
        }

        .meta-item { }
        .meta-label {
            font-family: var(--mono);
            font-size: 0.62rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .meta-value {
            font-size: 0.85rem;
            color: var(--ink);
        }

        .generic-block { position: relative; }

        .generic-text {
            font-family: var(--sans);
            font-size: 1rem;
            line-height: 1.8;
            color: var(--ink-soft);
            white-space: pre-wrap;
        }

        .generic-img {
            width: 100%;
            height: auto;
            display: block;
            background: var(--bg2);
        }

        /* ========================================
           CONTACT
           ======================================== */
        #contact-view {
            padding: 5rem 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: start;
        }

        .contact-left { }

        .contact-h1 {
            font-family: var(--serif);
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 400;
            line-height: 1.1;
            margin-bottom: 24px;
        }

        .contact-body {
            font-size: 1rem;
            color: var(--ink-soft);
            line-height: 1.7;
            font-style: italic;
            margin-bottom: 32px;
        }

        .contact-email {
            font-family: var(--mono);
            font-size: 0.9rem;
            color: var(--ink);
            text-decoration: none;
            border-bottom: 1px solid var(--ink);
            padding-bottom: 2px;
            transition: color 0.2s;
        }

        .contact-email:hover { color: var(--accent); border-color: var(--accent); }

        .contact-right { padding-top: 10px; }

        .contact-img {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            display: block;
            background: var(--bg2);
            margin-bottom: 24px;
            filter: grayscale(30%);
        }

        .btn-cv {
            display: inline-block;
            padding: 12px 28px;
            background: var(--ink);
            color: var(--white);
            font-family: var(--mono);
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            text-decoration: none;
            transition: all 0.2s var(--ease);
            margin-bottom: 24px;
        }

        .btn-cv:hover {
            background: var(--accent);
        }

        .social-row {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .social-link {
            font-family: var(--mono);
            font-size: 0.68rem;
            color: var(--ink-soft);
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            transition: color 0.2s;
        }

        .social-link:hover { color: var(--accent); }

        /* ========================================
           LIGHTBOX
           ======================================== */
        #lightbox {
            position: fixed;
            inset: 0;
            background: rgba(28, 27, 24, 0.97);
            z-index: 8000;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
        }

        #lightbox.open { display: flex; }

        #lightbox img {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
        }

        /* EDITOR-ONLY-START */
        /* Star / feature button on project cards */
        .star-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--rule);
            border-radius: 2px;
            width: 28px;
            height: 28px;
            font-size: 0.85rem;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--ink-pale);
            z-index: 5;
            transition: color 0.2s, background 0.2s;
            line-height: 1;
            padding: 0;
        }
        .star-btn:hover { color: #c8a000; background: #fff; }
        .star-btn.star-on { color: #c8a000; background: #fffbe6; border-color: #c8a000; }

        /* Show star button only in editing mode */
        body.editing-mode .star-btn { display: flex; }

        /* Hint shown only in editing mode */
        .editor-only-el { display: none; }
        body.editing-mode .editor-only-el { display: block; }

        /* Embed edit button */
        .embed-edit-btn {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--ink);
            color: var(--white);
            border: none;
            padding: 6px 12px;
            font-family: var(--mono);
            font-size: 0.65rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            z-index: 20;
            align-items: center;
            gap: 5px;
            transition: background 0.15s;
        }
        .embed-edit-btn:hover { background: var(--accent2); }

        /* ========================================
           FREE BLOCKS — drag, resize, toolbar
           ======================================== */
        .free-block {
            position: absolute;
            z-index: 100;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1.5px solid transparent;
            transition: border-color 0.15s;
            display: flex;
            flex-direction: column;
            min-width: 120px;
            min-height: 60px;
        }

        .free-block.fb-selected {
            border-color: var(--accent2);
            box-shadow: 0 4px 24px rgba(45,90,142,0.18);
        }

        /* Toolbar — visível só quando selected */
        .fb-toolbar {
            display: none;
            align-items: center;
            gap: 2px;
            background: var(--ink);
            padding: 5px 8px;
            position: absolute;
            top: -38px;
            left: 0;
            white-space: nowrap;
            z-index: 10;
            border-radius: 3px 3px 0 0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.15);
        }

        .free-block.fb-selected .fb-toolbar { display: flex; }

        .fb-tool {
            font-family: var(--mono);
            font-size: 0.65rem;
            color: rgba(255,255,255,0.75);
            background: none;
            border: none;
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 2px;
            transition: background 0.15s, color 0.15s;
            line-height: 1;
        }

        .fb-tool:hover { background: rgba(255,255,255,0.12); color: #fff; }

        .fb-drag-handle {
            cursor: grab;
            font-size: 1rem;
            padding: 2px 6px;
            letter-spacing: -2px;
            color: rgba(255,255,255,0.45);
        }

        .fb-drag-handle:hover { color: rgba(255,255,255,0.9); }
        .fb-drag-handle:active { cursor: grabbing; }

        .fb-sep {
            width: 1px;
            height: 14px;
            background: rgba(255,255,255,0.15);
            margin: 0 3px;
            padding: 0;
            cursor: default;
        }

        .fb-del {
            color: rgba(255,100,80,0.7) !important;
            margin-left: 2px;
        }
        .fb-del:hover { background: rgba(193,68,14,0.3) !important; color: #fff !important; }

        select.fb-tool {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.75);
            font-family: var(--mono);
            font-size: 0.62rem;
            padding: 2px 4px;
            cursor: pointer;
            outline: none;
        }

        select.fb-tool option { background: #222; color: #fff; }

        /* Text content area */
        .fb-text .fb-content {
            flex: 1;
            padding: 16px 18px;
            outline: none;
            background: var(--white);
            line-height: 1.6;
            color: var(--ink);
            min-height: 80px;
            cursor: text;
            overflow: auto;
        }

        .fb-text .fb-content:empty::before {
            content: 'Clique para editar...';
            color: var(--ink-pale);
            font-style: italic;
        }

        /* Image content area */
        .fb-image .fb-content {
            flex: 1;
            overflow: hidden;
            background: var(--bg2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fb-image .fb-content img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Resize handle */
        .fb-resize {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 22px;
            height: 22px;
            cursor: nwse-resize;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--accent2);
            background: rgba(255,255,255,0.85);
            border-top: 1px solid var(--rule);
            border-left: 1px solid var(--rule);
            line-height: 1;
            user-select: none;
        }

        .free-block.fb-selected .fb-resize { display: flex; }

        /* Prevent toolbar from triggering drag on its own elements */
        .fb-toolbar * { user-select: none; }

        /* ========================================
           EDITOR — PROFESSIONAL UI v2
           ======================================== */

        /* ── Activate pill (view mode only) ── */
        #editor-activate {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 8000;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #111;
            color: #fff;
            border: none;
            padding: 11px 18px 11px 14px;
            font-family: var(--mono);
            font-size: 0.68rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 40px;
            box-shadow: 0 6px 28px rgba(0,0,0,0.28);
            transition: background 0.18s, transform 0.15s, box-shadow 0.18s;
        }
        #editor-activate:hover {
            background: #2a2a2a;
            transform: translateY(-2px);
            box-shadow: 0 10px 36px rgba(0,0,0,0.34);
        }
        #editor-activate .ea-icon {
            width: 22px; height: 22px;
            background: var(--accent);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
        }
        body.editing-mode #editor-activate { display: none; }

        /* ── Top bar (edit mode) ── */
        #editor-topbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 52px;
            background: #111;
            color: #fff;
            z-index: 9000;
            display: none;
            align-items: center;
            padding: 0 16px;
            gap: 0;
            border-bottom: 1px solid rgba(255,255,255,0.07);
            font-family: var(--mono);
        }
        body.editing-mode #editor-topbar { display: flex; }
        body.editing-mode { padding-top: 52px; }
        body.editing-mode .container { margin-left: 0; }

        /* Topbar sections */
        .etb-brand {
            display: flex; align-items: center; gap: 8px;
            padding-right: 20px;
            border-right: 1px solid rgba(255,255,255,0.08);
            flex-shrink: 0;
        }
        .etb-brand-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 8px rgba(193,68,14,0.6);
        }
        .etb-brand-name {
            font-size: 0.62rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
        }
        .etb-brand-name span { color: rgba(255,255,255,0.85); }

        /* Context breadcrumb */
        .etb-context {
            flex: 1;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .etb-context-page {
            font-size: 0.62rem;
            color: rgba(255,255,255,0.28);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        .etb-context-sep { color: rgba(255,255,255,0.15); font-size: 0.65rem; }
        .etb-context-current {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.7);
            letter-spacing: 0.08em;
        }
        .etb-editing-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(193,68,14,0.18);
            border: 1px solid rgba(193,68,14,0.35);
            color: #e06030;
            padding: 3px 9px;
            border-radius: 20px;
            font-size: 0.58rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-left: 8px;
        }
        .etb-editing-badge::before {
            content: '';
            width: 5px; height: 5px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse-dot 1.4s infinite;
        }

        /* Topbar right actions */
        .etb-actions {
            display: flex;
            align-items: center;
            gap: 6px;
            padding-left: 16px;
            border-left: 1px solid rgba(255,255,255,0.08);
            flex-shrink: 0;
        }
        .etb-btn {
            display: flex; align-items: center; gap: 6px;
            padding: 6px 13px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.65);
            font-family: var(--mono);
            font-size: 0.62rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s;
            white-space: nowrap;
        }
        .etb-btn:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border-color: rgba(255,255,255,0.3);
        }
        .etb-btn-save {
            background: rgba(45,90,142,0.3);
            border-color: rgba(45,90,142,0.5);
            color: #7aabdb;
        }
        .etb-btn-save:hover {
            background: rgba(45,90,142,0.55);
            color: #c4dff5;
            border-color: rgba(45,90,142,0.8);
        }
        .etb-btn-exit {
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.4);
        }
        .etb-btn-exit:hover { background: rgba(255,255,255,0.09); color: #fff; }
        .etb-btn-mobile-menu { display: none; }
        .etb-btn-publish {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }
        .etb-btn-publish:hover { background: #a33608; border-color: #a33608; }

        /* Topbar status */
        .etb-status {
            display: flex; align-items: center; gap: 6px;
            padding: 0 16px;
            border-right: 1px solid rgba(255,255,255,0.08);
            flex-shrink: 0;
        }
        .etb-status-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #3cb370;
            box-shadow: 0 0 6px rgba(60,179,112,0.5);
            transition: background 0.3s;
        }
        .etb-status-dot.pending {
            background: #c8a000;
            box-shadow: 0 0 6px rgba(200,160,0,0.5);
            animation: pulse-dot 1.2s infinite;
        }
        .etb-status-dot.error { background: var(--accent); box-shadow: none; }
        .etb-status-label {
            font-size: 0.6rem;
            color: rgba(255,255,255,0.28);
            letter-spacing: 0.08em;
        }

        /* ── Add panel — slides in from bottom ── */
        #editor-add-panel {
            position: fixed;
            left: 50%;
            transform: translateX(-50%) translateY(0);
            bottom: 16px;
            z-index: 8500;
            display: none;
            align-items: center;
            gap: 4px;
            background: #1a1a1c;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 40px;
            padding: 6px 8px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.4);
            font-family: var(--mono);
            backdrop-filter: blur(8px);
        }
        body.editing-mode #editor-add-panel { display: flex; }

        .eap-btn {
            display: flex; align-items: center; gap: 6px;
            padding: 7px 14px;
            border: none;
            background: rgba(255,255,255,0.0);
            color: rgba(255,255,255,0.55);
            font-family: var(--mono);
            font-size: 0.62rem;
            letter-spacing: 0.07em;
            cursor: pointer;
            border-radius: 30px;
            transition: background 0.15s, color 0.15s;
            white-space: nowrap;
        }
        .eap-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .eap-btn.eap-active { background: rgba(255,255,255,0.08); color: #fff; }
        .eap-sep {
            width: 1px; height: 20px;
            background: rgba(255,255,255,0.1);
            margin: 0 2px;
            flex-shrink: 0;
        }
        .eap-btn-accent {
            background: rgba(193,68,14,0.15);
            color: #e06030;
        }
        .eap-btn-accent:hover { background: rgba(193,68,14,0.28); color: #f07040; }

        /* ── Right panel — contextual add blocks (only in detail view) ── */
        #editor-right-panel {
            position: fixed;
            top: 52px; right: 0;
            width: 220px;
            height: calc(100vh - 52px);
            background: #111;
            border-left: 1px solid rgba(255,255,255,0.07);
            z-index: 8000;
            display: none;
            flex-direction: column;
            font-family: var(--mono);
            overflow-y: auto;
            transition: opacity 0.2s;
        }
        body.editing-mode.detail-open #editor-right-panel { display: flex; }
        body.editing-mode.detail-open .container { padding-right: 240px; }

        .erp-header {
            padding: 14px 14px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.07);
            font-size: 0.55rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.25);
            flex-shrink: 0;
        }
        .erp-group { padding: 12px 12px 6px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .erp-label {
            font-size: 0.52rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.18);
            margin-bottom: 6px;
        }
        .erp-btn {
            display: flex; align-items: center; gap: 8px;
            width: 100%;
            padding: 8px 8px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.55);
            font-family: var(--mono);
            font-size: 0.65rem;
            letter-spacing: 0.05em;
            text-align: left;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 1px;
            transition: background 0.12s, color 0.12s;
        }
        .erp-btn:hover { background: rgba(255,255,255,0.07); color: #fff; }
        .erp-icon {
            width: 26px; height: 26px;
            background: rgba(255,255,255,0.06);
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
        }

        /* ── Sync dot (legacy, used in some older calls) ── */
        .sync-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #3a8a3a; display: inline-block;
            transition: background 0.3s;
        }
        .sync-dot.pending { background: #c19a0e; animation: pulse-dot 1.2s infinite; }
        .sync-dot.error   { background: var(--accent); }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50%       { opacity: 0.3; }
        }

        /* ── Editing state indicators ── */
        body.editing-mode { outline: 2px solid var(--accent); outline-offset: -2px; }

        [contenteditable="true"] {
            outline: 1.5px dashed rgba(193,68,14,0.4);
            background: rgba(193,68,14,0.03);
            border-radius: 2px;
            cursor: text;
            transition: outline 0.12s, background 0.12s;
        }
        [contenteditable="true"]:hover { outline-color: rgba(193,68,14,0.75); }
        [contenteditable="true"]:focus {
            outline: 2px solid var(--accent);
            background: rgba(255,255,255,0.65);
        }

        .editable-img:hover {
            outline: 2.5px solid var(--accent);
            cursor: pointer;
            opacity: 0.82;
        }

        .editable-link.editing {
            outline: 1px dashed var(--accent2);
            cursor: pointer;
            background: rgba(45,90,142,0.06);
        }

        /* Delete button — appears on hover of parent */
        .delete-btn {
            position: absolute;
            top: 8px; right: 8px;
            background: rgba(15,12,18,0.85);
            color: #ff7c60;
            border: 1px solid rgba(255,124,96,0.35);
            padding: 4px 9px;
            z-index: 20;
            cursor: pointer;
            display: none;
            font-family: var(--mono);
            font-size: 0.58rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-radius: 20px;
            backdrop-filter: blur(4px);
            transition: background 0.15s, border-color 0.15s;
        }
        .delete-btn:hover {
            background: rgba(193,68,14,0.9);
            color: #fff;
            border-color: var(--accent);
        }

        /* Legacy .btn for gist modal */
        .btn {
            padding: 7px 14px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.7);
            font-family: var(--mono);
            font-size: 0.65rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn:hover { border-color: rgba(255,255,255,0.7); color: #fff; }
        .btn-main { background: var(--accent); border-color: var(--accent); color: #fff; }
        .btn-main:hover { background: #a33608; }
        .btn-save { background: var(--accent2); border-color: var(--accent2); color: #fff; }
        .btn-save:hover { background: #234a75; }
        .editor-divider { width: 1px; height: 20px; background: rgba(255,255,255,0.1); margin: 0 4px; }

        /* Editor-only elements */
        .editor-only-el { display: none; }
        body.editing-mode .editor-only-el { display: block; }

        /* EDITOR-ONLY-END */


        /* ========================================
           MOBILE HAMBURGER MENU
           ======================================== */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: 1.5px solid var(--rule);
            width: 40px;
            height: 40px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            flex-shrink: 0;
            transition: border-color 0.2s;
        }
        .mobile-menu-btn:hover { border-color: var(--ink); }
        .mobile-menu-btn svg { display: block; }

        .mobile-nav-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(28,27,24,0.6);
            z-index: 7500;
            backdrop-filter: blur(3px);
            opacity: 0;
            transition: opacity 0.25s var(--ease);
        }
        .mobile-nav-overlay.open { opacity: 1; }

        .mobile-nav-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: min(320px, 85vw);
            height: 100%;
            background: var(--bg);
            z-index: 7600;
            transform: translateX(100%);
            transition: transform 0.3s var(--ease-out);
            display: flex;
            flex-direction: column;
            box-shadow: -8px 0 40px rgba(0,0,0,0.15);
            overflow-y: auto;
        }
        .mobile-nav-drawer.open { transform: translateX(0); }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--rule);
        }
        .mobile-nav-header-title {
            font-family: var(--mono);
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--ink-pale);
        }
        .mobile-nav-close {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: var(--ink-soft);
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        .mobile-nav-links {
            padding: 12px 0;
            flex: 1;
        }
        .mobile-nav-links a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 28px;
            font-family: var(--sans);
            font-size: 1rem;
            font-weight: 400;
            color: var(--ink-soft);
            text-decoration: none;
            transition: background 0.15s, color 0.15s;
            cursor: pointer;
        }
        .mobile-nav-links a:hover,
        .mobile-nav-links a.active {
            background: var(--bg2);
            color: var(--ink);
        }
        .mobile-nav-links a.active {
            border-left: 3px solid var(--accent);
            padding-left: 25px;
        }
        .mobile-nav-links a.private-mobile {
            color: var(--accent);
        }
        .mobile-nav-links .mobile-nav-sep {
            height: 1px;
            background: var(--rule);
            margin: 8px 24px;
        }
        .mobile-nav-lang {
            padding: 20px 28px;
            border-top: 1px solid var(--rule);
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .mobile-nav-lang .flag-btn { opacity: 0.4; font-size: 1.4rem; }
        body.lang-pt .mobile-nav-lang .flag-btn[data-lang="pt"] { opacity: 1; }
        body.lang-en .mobile-nav-lang .flag-btn[data-lang="en"] { opacity: 1; }

        /* ========================================
           MOBILE EDITOR ACTIONS DRAWER
           ======================================== */
        .mobile-editor-actions-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9500;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .mobile-editor-actions-overlay.open { opacity: 1; }

        .mobile-editor-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1c;
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 9600;
            transform: translateY(100%);
            transition: transform 0.3s var(--ease-out);
            border-radius: 16px 16px 0 0;
            padding: 8px 0 env(safe-area-inset-bottom, 16px);
            max-height: 70vh;
            overflow-y: auto;
        }
        .mobile-editor-actions.open { transform: translateY(0); }

        .mobile-editor-actions .mea-handle {
            width: 36px;
            height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            margin: 8px auto 16px;
        }
        .mobile-editor-actions .mea-title {
            font-family: var(--mono);
            font-size: 0.58rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.25);
            padding: 0 20px 10px;
        }
        .mobile-editor-actions .mea-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 14px 24px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.75);
            font-family: var(--mono);
            font-size: 0.75rem;
            letter-spacing: 0.06em;
            cursor: pointer;
            transition: background 0.12s;
            text-align: left;
        }
        .mobile-editor-actions .mea-btn:hover { background: rgba(255,255,255,0.06); }
        .mobile-editor-actions .mea-btn .mea-icon {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.06);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        .mobile-editor-actions .mea-sep {
            height: 1px;
            background: rgba(255,255,255,0.06);
            margin: 4px 20px;
        }
        .mobile-editor-actions .mea-btn-publish {
            color: #fff;
        }
        .mobile-editor-actions .mea-btn-publish .mea-icon {
            background: var(--accent);
        }
        .mobile-editor-actions .mea-btn-exit {
            color: rgba(255,255,255,0.4);
        }

        /* ========================================
           RESPONSIVE — TABLET (≤ 900px)
           ======================================== */
        @media (max-width: 900px) {
            .container { width: 92%; padding: 0 16px; }
            header { grid-template-columns: 1fr; gap: 16px; }
            .header-right { align-items: flex-start; flex-direction: row; justify-content: space-between; }
            .project-grid { grid-template-columns: 1fr 1fr; }
            .art-gallery-grid { grid-template-columns: 1fr 1fr; }
            .blog-grid { grid-template-columns: 1fr; }
            .blog-item:nth-child(even) { border-left: none; padding-left: 0; }
            .sketch-grid { grid-template-columns: repeat(3, 1fr); }
            #contact-view { grid-template-columns: 1fr; gap: 40px; }
            nav { flex-wrap: wrap; gap: 0; }
            .hps-top { grid-template-columns: 1fr; }
            .hps-bottom { grid-template-columns: 1fr; }
            .hps-images { grid-template-columns: repeat(3, 1fr); }
            .hps-right { aspect-ratio: 16/9; min-height: unset; }
            .banner-title { font-size: 2rem; }
            .banner-text { padding: 24px; }
        }

        /* ========================================
           RESPONSIVE — MOBILE (≤ 680px)
           ======================================== */
        @media (max-width: 680px) {
            body {
                padding-bottom: 24px;
                -webkit-text-size-adjust: 100%;
            }

            .container {
                width: 100%;
                padding: 0 16px;
                min-width: unset;
            }

            /* ── HEADER MOBILE ── */
            header {
                grid-template-columns: 1fr auto;
                align-items: center;
                padding: 14px 0;
                gap: 12px;
            }

            .header-name {
                font-size: 1.6rem;
            }
            .header-role {
                font-size: 0.68rem;
                margin-top: 4px;
            }

            .header-right {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }

            /* Hide desktop nav, show hamburger */
            .header-right nav { display: none; }
            .header-right .lang-icons { display: none; }
            .mobile-menu-btn { display: flex; }

            /* ── ISSUE BAR ── */
            .issue-bar {
                padding: 6px 0;
                flex-wrap: wrap;
                gap: 4px;
            }
            .issue-text { font-size: 0.58rem; }

            /* ── SECTION TITLES ── */
            .section-title {
                margin: 48px 0 28px;
                gap: 12px;
            }
            .section-label { font-size: 0.62rem; }

            /* ── BANNER HERO ── */
            .banner-container {
                height: clamp(200px, 55vw, 320px);
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }
            .banner-text {
                padding: 20px;
            }
            .banner-title {
                font-size: 1.7rem;
            }
            .banner-label {
                font-size: 0.6rem;
                margin-bottom: 6px;
            }

            /* ── HOME YT EMBED ── */
            .home-yt-wrap {
                margin: 20px -16px 0;
                width: calc(100% + 32px);
            }
            .embed-area iframe {
                aspect-ratio: 16/9;
            }

            /* ── FEATURED PROJECT SECTIONS ── */
            .home-proj-section {
                padding: 32px 0;
            }
            .hps-index { margin-bottom: 12px; }
            .hps-title {
                font-size: 1.6rem;
                margin-bottom: 10px;
            }
            .hps-subtitle {
                font-size: 0.9rem;
                margin-bottom: 20px;
                max-width: none;
            }
            .hps-right {
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
                aspect-ratio: 16/10;
            }
            .hps-embed-wrap {
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }
            .hps-images {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
                padding: 0;
            }
            .hps-img-item { aspect-ratio: 1/1; }
            .hps-footer { margin-top: 20px; padding-top: 16px; }
            .hps-link { font-size: 0.65rem; padding: 10px 0; }
            .hps-top { margin-bottom: 20px; }

            /* ── SKETCHBOOK ── */
            .sketch-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-bottom: 2rem;
            }

            /* ── BOTTOM BANNER ── */
            .bottom-banner {
                height: 180px;
                margin-top: 48px;
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }
            .bottom-banner-text {
                font-size: 1.1rem;
                padding: 0 20px;
            }
            .bottom-banner-cta { font-size: 0.65rem; }

            /* ── PROJECT GRID ── */
            .project-grid {
                grid-template-columns: 1fr;
                gap: 28px;
            }
            .card-thumb-wrap {
                margin-bottom: 10px;
                aspect-ratio: 16/10;
            }
            .card-title { font-size: 1.05rem; }
            .card-tag { font-size: 0.58rem; margin-bottom: 4px; }

            /* ── ART GALLERY ── */
            .gallery-header {
                grid-template-columns: 1fr;
                gap: 8px;
                margin: 2rem 0 1.5rem;
            }
            .gallery-h1 { font-size: 1.8rem; }
            .art-gallery-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            .art-caption { font-size: 0.6rem; padding: 8px 0 0; }

            /* ── BLOG ── */
            .blog-grid {
                grid-template-columns: 1fr;
                margin-bottom: 2rem;
            }
            .blog-item {
                padding: 20px 0;
            }
            .blog-item:nth-child(even) {
                border-left: none;
                padding-left: 0;
            }
            .blog-title { font-size: 1.15rem; }
            .blog-excerpt { font-size: 0.8rem; }

            /* ── DETAIL VIEW ── */
            .detail-title {
                font-size: 1.8rem;
            }
            .detail-desc {
                font-size: 0.92rem;
                max-width: none;
            }
            .detail-header {
                padding-bottom: 20px;
            }
            .detail-meta {
                flex-direction: column;
                gap: 16px;
                margin-top: 16px;
            }
            .generic-text {
                font-size: 0.92rem;
                line-height: 1.7;
            }
            .generic-img {
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }
            .back-btn {
                padding: 16px 0;
                font-size: 0.68rem;
            }

            /* ── CONTACT ── */
            #contact-view {
                grid-template-columns: 1fr;
                gap: 32px;
                padding: 3rem 0;
            }
            .contact-h1 {
                font-size: 2rem;
                margin-bottom: 16px;
            }
            .contact-body {
                font-size: 0.92rem;
                margin-bottom: 24px;
            }
            .contact-img {
                aspect-ratio: 4/3;
                margin-bottom: 16px;
            }
            .social-row {
                flex-wrap: wrap;
                gap: 12px;
            }
            .btn-cv {
                padding: 14px 28px;
                font-size: 0.72rem;
                display: block;
                text-align: center;
            }

            /* ── LIGHTBOX ── */
            #lightbox img {
                max-width: 96vw;
                max-height: 85vh;
            }

            /* ── EMBED ── */
            .embed-wrapper {
                margin-left: -16px;
                margin-right: -16px;
                width: calc(100% + 32px);
            }

            /* ── EDITOR TOP BAR — MOBILE ── */
            body.editing-mode { padding-top: 48px; }
            #editor-topbar {
                height: 48px;
                padding: 0 10px;
                gap: 6px;
            }
            .etb-brand {
                padding-right: 10px;
            }
            .etb-brand-name { display: none; }
            .etb-context { display: none; }
            .etb-status { padding: 0 8px; }
            .etb-status-label { display: none; }
            .etb-actions {
                display: flex;
                align-items: center;
                gap: 0;
            }
            /* Hide most actions, show mobile toggle */
            .etb-actions > .etb-btn { display: none; }
            .etb-btn-mobile-menu {
                display: none;
            }

            body.editing-mode .etb-btn-mobile-menu { display: flex; }
            body.editing-mode .etb-actions > .etb-btn:not(.etb-btn-mobile-menu) { display: none; }
            body.editing-mode .etb-btn-publish { display: flex !important; }
            body.editing-mode .etb-btn-exit { display: flex !important; }

            .etb-btn {
                padding: 6px 10px;
                font-size: 0.58rem;
            }
            .etb-btn-publish {
                padding: 6px 12px;
            }

            /* ── ADD PANEL — MOBILE ── */
            #editor-add-panel {
                bottom: env(safe-area-inset-bottom, 10px);
                padding: 5px 6px;
                gap: 2px;
                max-width: calc(100vw - 16px);
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 28px;
            }
            .eap-btn {
                padding: 8px 12px;
                font-size: 0.58rem;
                flex-shrink: 0;
            }
            .eap-sep { margin: 0 1px; }

            /* ── RIGHT PANEL — BOTTOM SHEET ON MOBILE ── */
            body.editing-mode.detail-open #editor-right-panel {
                position: fixed;
                top: unset;
                right: 0;
                bottom: 0;
                left: 0;
                width: 100%;
                height: auto;
                max-height: 45vh;
                border-left: none;
                border-top: 1px solid rgba(255,255,255,0.1);
                border-radius: 16px 16px 0 0;
                overflow-y: auto;
            }
            body.editing-mode.detail-open .container {
                padding-right: 16px;
                padding-bottom: 180px;
            }

            /* ── STAR BUTTON — LARGER TOUCH ── */
            .star-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
                top: 10px;
                left: 10px;
            }

            /* ── DELETE BUTTON — LARGER TOUCH ── */
            .delete-btn {
                padding: 8px 14px;
                font-size: 0.62rem;
            }

            /* ── EMBED EDIT BUTTON ── */
            .embed-edit-btn {
                padding: 8px 14px;
                font-size: 0.62rem;
            }

            /* ── EDITABLE ELEMENTS — BIGGER TOUCH TARGETS ── */
            [contenteditable="true"] {
                min-height: 32px;
                padding: 2px;
            }

            /* ── SYNC MODAL — FULL WIDTH ── */
            #sync-modal {
                width: 100vw;
                max-height: 100vh;
                height: 100vh;
                border: none;
            }
            .sync-modal-body { padding: 16px; }
            .sync-actions {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            .sync-btn {
                padding: 14px 16px;
            }
            .sync-info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .sync-input {
                font-size: 16px; /* prevents iOS zoom */
            }

            /* ── FREE BLOCKS — SIMPLIFIED ON MOBILE ── */
            .free-block {
                max-width: calc(100vw - 32px) !important;
                min-width: 100px;
            }
            .fb-toolbar {
                top: -34px;
                padding: 4px 6px;
                overflow-x: auto;
                max-width: 90vw;
            }
            .fb-tool {
                padding: 5px 8px;
                font-size: 0.62rem;
            }

            /* ── EDITOR ACTIVATE PILL ── */
            #editor-activate {
                bottom: 16px;
                right: 16px;
                padding: 10px 16px 10px 12px;
                font-size: 0.65rem;
            }
        }

        /* ========================================
           RESPONSIVE — SMALL MOBILE (≤ 400px)
           ======================================== */
        @media (max-width: 400px) {
            .header-name { font-size: 1.35rem; }
            .banner-title { font-size: 1.4rem; }
            .hps-title { font-size: 1.3rem; }
            .detail-title { font-size: 1.5rem; }
            .contact-h1 { font-size: 1.7rem; }
            .gallery-h1 { font-size: 1.5rem; }
            .sketch-grid { grid-template-columns: repeat(2, 1fr); }
            .hps-images { grid-template-columns: repeat(2, 1fr); }

            #editor-add-panel {
                border-radius: 0;
                bottom: 0;
                left: 0;
                right: 0;
                transform: none;
                max-width: 100vw;
                padding: 6px 8px env(safe-area-inset-bottom, 8px);
            }
        }

        /* ========================================
           DEVICE PREVIEW TOGGLE
           ======================================== */

        /* Toggle button — always visible on desktop */
        #device-toggle {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 8100;
            display: flex;
            align-items: center;
            gap: 0;
            background: #111;
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 40px;
            padding: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            font-family: var(--mono);
        }
        body.editing-mode #device-toggle { bottom: 72px; }

        .dt-option {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 14px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.4);
            font-family: var(--mono);
            font-size: 0.62rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.2s var(--ease);
            white-space: nowrap;
        }
        .dt-option:hover { color: rgba(255,255,255,0.7); }
        .dt-option.dt-active {
            background: rgba(255,255,255,0.12);
            color: #fff;
        }
        .dt-option svg { flex-shrink: 0; }

        /* Phone frame wrapper */
        .phone-frame {
            display: none;
        }

        /* ── Force-mobile on desktop: phone simulator ── */
        body.force-mobile .phone-frame {
            display: flex;
            flex-direction: column;
            width: 390px;
            max-height: calc(100vh - 60px);
            margin: 30px auto;
            background: var(--bg);
            border-radius: 32px;
            border: 3px solid #333;
            box-shadow:
                0 20px 80px rgba(0,0,0,0.25),
                0 0 0 1px rgba(0,0,0,0.1),
                inset 0 0 0 1px rgba(255,255,255,0.04);
            overflow: hidden;
            position: relative;
        }

        body.force-mobile.editing-mode .phone-frame {
            margin-top: 80px;
            max-height: calc(100vh - 120px);
        }

        .phone-frame-notch {
            width: 130px;
            height: 26px;
            background: #333;
            border-radius: 0 0 16px 16px;
            margin: 0 auto;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
        }
        .phone-frame-notch::after {
            content: '';
            display: block;
            width: 10px;
            height: 10px;
            background: #222;
            border-radius: 50%;
            margin: 6px auto 0;
            border: 1.5px solid #444;
        }

        .phone-frame-scroll {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .phone-frame-home {
            width: 120px;
            height: 4px;
            background: #555;
            border-radius: 2px;
            margin: 8px auto 12px;
            flex-shrink: 0;
        }

        /* When force-mobile, hide real container, show phone frame */
        body.force-mobile {
            background: #1a1a1c;
            overflow-x: hidden;
        }
        body.force-mobile > .container {
            display: none;
        }
        body.force-mobile > .phone-frame {
            display: flex;
        }

        /* Inner container inside the phone frame */
        body.force-mobile .phone-frame .container {
            display: block;
            width: 100%;
            padding: 0 16px;
            min-width: unset;
        }

        /* Grain overlay stays on */
        body.force-mobile::before { display: none; }

        /* ── Force-mobile: all mobile layout styles ── */
        body.force-mobile .phone-frame header {
            grid-template-columns: 1fr auto;
            align-items: center;
            padding: 14px 0;
            gap: 12px;
        }
        body.force-mobile .phone-frame .header-name { font-size: 1.6rem; }
        body.force-mobile .phone-frame .header-role { font-size: 0.68rem; margin-top: 4px; }
        body.force-mobile .phone-frame .header-right {
            flex-direction: row; align-items: center; gap: 8px;
        }
        body.force-mobile .phone-frame .header-right nav { display: none; }
        body.force-mobile .phone-frame .header-right .lang-icons { display: none; }
        body.force-mobile .phone-frame .mobile-menu-btn { display: flex; }

        body.force-mobile .phone-frame .issue-bar { padding: 6px 0; flex-wrap: wrap; gap: 4px; }
        body.force-mobile .phone-frame .issue-text { font-size: 0.58rem; }

        body.force-mobile .phone-frame .section-title { margin: 48px 0 28px; gap: 12px; }
        body.force-mobile .phone-frame .section-label { font-size: 0.62rem; }

        body.force-mobile .phone-frame .banner-container {
            height: 200px;
            margin-left: -16px; margin-right: -16px;
            width: calc(100% + 32px);
        }
        body.force-mobile .phone-frame .banner-text { padding: 20px; }
        body.force-mobile .phone-frame .banner-title { font-size: 1.7rem; }
        body.force-mobile .phone-frame .banner-label { font-size: 0.6rem; margin-bottom: 6px; }

        body.force-mobile .phone-frame .home-yt-wrap {
            margin: 20px -16px 0; width: calc(100% + 32px);
        }

        body.force-mobile .phone-frame .home-proj-section { padding: 32px 0; }
        body.force-mobile .phone-frame .hps-title { font-size: 1.6rem; margin-bottom: 10px; }
        body.force-mobile .phone-frame .hps-subtitle { font-size: 0.9rem; margin-bottom: 20px; max-width: none; }
        body.force-mobile .phone-frame .hps-right {
            margin-left: -16px; margin-right: -16px;
            width: calc(100% + 32px); aspect-ratio: 16/10;
        }
        body.force-mobile .phone-frame .hps-embed-wrap {
            margin-left: -16px; margin-right: -16px;
            width: calc(100% + 32px);
        }
        body.force-mobile .phone-frame .hps-images {
            grid-template-columns: repeat(3, 1fr); gap: 6px;
            margin-left: -16px; margin-right: -16px;
            width: calc(100% + 32px);
        }
        body.force-mobile .phone-frame .hps-img-item { aspect-ratio: 1/1; }
        body.force-mobile .phone-frame .hps-footer { margin-top: 20px; padding-top: 16px; }
        body.force-mobile .phone-frame .hps-link { font-size: 0.65rem; padding: 10px 0; }
        body.force-mobile .phone-frame .hps-top { margin-bottom: 20px; }
        body.force-mobile .phone-frame .hps-index { margin-bottom: 12px; }

        body.force-mobile .phone-frame .sketch-grid {
            grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 2rem;
        }

        body.force-mobile .phone-frame .bottom-banner {
            height: 180px; margin-top: 48px;
            margin-left: -16px; margin-right: -16px;
            width: calc(100% + 32px);
        }
        body.force-mobile .phone-frame .bottom-banner-text { font-size: 1.1rem; padding: 0 20px; }
        body.force-mobile .phone-frame .bottom-banner-cta { font-size: 0.65rem; }

        body.force-mobile .phone-frame .project-grid { grid-template-columns: 1fr; gap: 28px; }
        body.force-mobile .phone-frame .card-thumb-wrap { margin-bottom: 10px; aspect-ratio: 16/10; }
        body.force-mobile .phone-frame .card-title { font-size: 1.05rem; }
        body.force-mobile .phone-frame .card-tag { font-size: 0.58rem; margin-bottom: 4px; }

        body.force-mobile .phone-frame .gallery-header {
            grid-template-columns: 1fr; gap: 8px; margin: 2rem 0 1.5rem;
        }
        body.force-mobile .phone-frame .gallery-h1 { font-size: 1.8rem; }
        body.force-mobile .phone-frame .art-gallery-grid { grid-template-columns: 1fr; gap: 24px; }
        body.force-mobile .phone-frame .art-caption { font-size: 0.6rem; padding: 8px 0 0; }

        body.force-mobile .phone-frame .blog-grid { grid-template-columns: 1fr; margin-bottom: 2rem; }
        body.force-mobile .phone-frame .blog-item { padding: 20px 0; }
        body.force-mobile .phone-frame .blog-item:nth-child(even) { border-left: none; padding-left: 0; }
        body.force-mobile .phone-frame .blog-title { font-size: 1.15rem; }
        body.force-mobile .phone-frame .blog-excerpt { font-size: 0.8rem; }

        body.force-mobile .phone-frame .detail-title { font-size: 1.8rem; }
        body.force-mobile .phone-frame .detail-desc { font-size: 0.92rem; max-width: none; }
        body.force-mobile .phone-frame .detail-header { padding-bottom: 20px; }
        body.force-mobile .phone-frame .detail-meta { flex-direction: column; gap: 16px; margin-top: 16px; }
        body.force-mobile .phone-frame .generic-text { font-size: 0.92rem; line-height: 1.7; }
        body.force-mobile .phone-frame .generic-img {
            margin-left: -16px; margin-right: -16px; width: calc(100% + 32px);
        }
        body.force-mobile .phone-frame .back-btn { padding: 16px 0; font-size: 0.68rem; }

        body.force-mobile .phone-frame #contact-view {
            grid-template-columns: 1fr; gap: 32px; padding: 3rem 0;
        }
        body.force-mobile .phone-frame .contact-h1 { font-size: 2rem; margin-bottom: 16px; }
        body.force-mobile .phone-frame .contact-body { font-size: 0.92rem; margin-bottom: 24px; }
        body.force-mobile .phone-frame .contact-img { aspect-ratio: 4/3; margin-bottom: 16px; }
        body.force-mobile .phone-frame .social-row { flex-wrap: wrap; gap: 12px; }
        body.force-mobile .phone-frame .btn-cv {
            padding: 14px 28px; font-size: 0.72rem; display: block; text-align: center;
        }

        body.force-mobile .phone-frame .embed-wrapper {
            margin-left: -16px; margin-right: -16px; width: calc(100% + 32px);
        }

        body.force-mobile .phone-frame .star-btn { width: 36px; height: 36px; font-size: 1rem; }
        body.force-mobile .phone-frame .delete-btn { padding: 8px 14px; font-size: 0.62rem; }

        /* Editor elements inside force-mobile */
        body.force-mobile.editing-mode .phone-frame [contenteditable="true"] {
            min-height: 32px; padding: 2px;
        }

        /* Hide device toggle on real mobile devices */
        @media (max-width: 680px) {
            #device-toggle { display: none; }
            .phone-frame { display: none !important; }
        }

        /* EDITOR-ONLY-START */
        /* ========================================
           GIST SYNC MODAL
           ======================================== */
        #sync-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(28, 27, 24, 0.85);
            z-index: 8500;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        #sync-modal-backdrop.open { display: flex; }

        #sync-modal {
            background: var(--bg);
            border: 1.5px solid var(--ink);
            width: min(520px, 92vw);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .sync-modal-header {
            padding: 20px 24px 16px;
            border-bottom: 1px solid var(--rule);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sync-modal-title {
            font-family: var(--mono);
            font-size: 0.72rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--ink);
        }

        .sync-modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-family: var(--mono);
            font-size: 0.72rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: color 0.2s;
        }
        .sync-modal-close:hover { color: var(--accent); }

        .sync-modal-body { padding: 24px; }

        .sync-field { margin-bottom: 20px; }

        .sync-label {
            display: block;
            font-family: var(--mono);
            font-size: 0.62rem;
            color: var(--ink-pale);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .sync-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--white);
            border: 1px solid var(--rule);
            font-family: var(--mono);
            font-size: 0.8rem;
            color: var(--ink);
            outline: none;
            transition: border-color 0.2s;
        }
        .sync-input:focus { border-color: var(--ink); }
        .sync-input::placeholder { color: var(--ink-pale); }

        .sync-hint {
            font-size: 0.75rem;
            color: var(--ink-pale);
            margin-top: 6px;
            line-height: 1.5;
            font-style: italic;
        }
        .sync-hint a { color: var(--accent2); }

        .sync-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 24px;
        }

        .sync-btn {
            padding: 12px 16px;
            border: 1.5px solid var(--ink);
            background: transparent;
            font-family: var(--mono);
            font-size: 0.68rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            color: var(--ink);
            transition: all 0.2s var(--ease);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .sync-btn:hover { background: var(--ink); color: var(--white); }
        .sync-btn:disabled { opacity: 0.35; cursor: not-allowed; }

        .sync-btn-push { border-color: var(--accent); color: var(--accent); }
        .sync-btn-push:hover { background: var(--accent); color: var(--white); border-color: var(--accent); }

        .sync-btn-pull { border-color: var(--accent2); color: var(--accent2); }
        .sync-btn-pull:hover { background: var(--accent2); color: var(--white); border-color: var(--accent2); }

        .sync-status {
            margin-top: 16px;
            padding: 10px 14px;
            font-family: var(--mono);
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            border-left: 3px solid var(--rule);
            color: var(--ink-soft);
            min-height: 40px;
            display: none;
            line-height: 1.5;
        }
        .sync-status.visible { display: block; }
        .sync-status.ok   { border-color: #3a8a3a; color: #3a8a3a; }
        .sync-status.err  { border-color: var(--accent); color: var(--accent); }
        .sync-status.info { border-color: var(--accent2); color: var(--accent2); }

        .sync-divider {
            border: none;
            border-top: 1px solid var(--rule);
            margin: 20px 0;
        }

        .sync-section-title {
            font-family: var(--mono);
            font-size: 0.62rem;
            color: var(--ink-pale);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 14px;
        }

        .sync-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .sync-info-item { }
        .sync-info-label {
            font-family: var(--mono);
            font-size: 0.58rem;
            color: var(--ink-pale);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 3px;
        }
        .sync-info-value {
            font-family: var(--mono);
            font-size: 0.75rem;
            color: var(--ink);
        }

        /* Sync indicator no editor panel */
        .sync-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--ink-pale);
            display: inline-block;
            margin-right: 4px;
            transition: background 0.3s;
        }
        .sync-dot.synced  { background: #3a8a3a; }
        .sync-dot.pending { background: #c19a0e; animation: pulse-dot 1.2s infinite; }
        .sync-dot.error   { background: var(--accent); }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50%       { opacity: 0.3; }
        }

        /* EDITOR-ONLY-END */

        /* ========================================
           PAGE ENTRY ANIMATION
           ======================================== */
        .fade-in {
            animation: fadeUp 0.4s var(--ease-out) both;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="lang-pt">

    <!-- PHONE FRAME (for desktop mobile preview) -->
    <div class="phone-frame" id="phone-frame">
        <div class="phone-frame-notch"></div>
        <div class="phone-frame-scroll" id="phone-frame-scroll">
            <!-- .container gets moved here when force-mobile is active -->
        </div>
        <div class="phone-frame-home"></div>
    </div>

    <!-- MOBILE NAV DRAWER -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay" onclick="closeMobileMenu()"></div>
    <div class="mobile-nav-drawer" id="mobile-nav-drawer">
        <div class="mobile-nav-header">
            <span class="mobile-nav-header-title">Menu</span>
            <button class="mobile-nav-close" onclick="closeMobileMenu()">✕</button>
        </div>
        <div class="mobile-nav-links">
            <a onclick="goHome();closeMobileMenu();" class="active" data-mobile-nav="work">
                <span class="pt-only">🏠 Home</span>
                <span class="en-only">🏠 Home</span>
            </a>
            <a onclick="goProjects();closeMobileMenu();" data-mobile-nav="projects">
                <span class="pt-only">📁 Projetos</span>
                <span class="en-only">📁 Projects</span>
            </a>
            <a onclick="goGallery();closeMobileMenu();" data-mobile-nav="gallery">
                <span class="pt-only">🎨 Galeria</span>
                <span class="en-only">🎨 Gallery</span>
            </a>
            <a onclick="goBlog();closeMobileMenu();" data-mobile-nav="blog">
                <span class="pt-only">📝 Notas</span>
                <span class="en-only">📝 Notes</span>
            </a>
            <div class="mobile-nav-sep"></div>
            <a onclick="togglePrivate();closeMobileMenu();" class="private-mobile" data-mobile-nav="private">
                <span class="pt-only">🔒 Restrito</span>
                <span class="en-only">🔒 Restricted</span>
            </a>
            <a onclick="goToContact();closeMobileMenu();" data-mobile-nav="contact">
                <span class="pt-only">✉ Contato</span>
                <span class="en-only">✉ Contact</span>
            </a>
        </div>
        <div class="mobile-nav-lang">
            <button class="flag-btn" data-lang="pt" onclick="setLang('pt')" title="Português">🇧🇷</button>
            <button class="flag-btn" data-lang="en" onclick="setLang('en')" title="English">🇺🇸</button>
        </div>
    </div>

    <!-- MOBILE EDITOR ACTIONS DRAWER -->
    <div class="mobile-editor-actions-overlay" id="mea-overlay" onclick="closeMobileEditorActions()"></div>
    <div class="mobile-editor-actions" id="mea-drawer">
        <div class="mea-handle"></div>
        <div class="mea-title">Ações do Editor</div>
        <button class="mea-btn" onclick="openSyncModal();closeMobileEditorActions();">
            <span class="mea-icon">☁</span> Gist Sync
        </button>
        <button class="mea-btn" onclick="exportJSON();closeMobileEditorActions();">
            <span class="mea-icon">↓</span> Backup
        </button>
        <button class="mea-btn" onclick="importJSON();closeMobileEditorActions();">
            <span class="mea-icon">↑</span> Restaurar
        </button>
        <button class="mea-btn" onclick="autoSave();closeMobileEditorActions();">
            <span class="mea-icon">💾</span> Salvar
        </button>
        <div class="mea-sep"></div>
        <button class="mea-btn mea-btn-publish" onclick="publishSite();closeMobileEditorActions();">
            <span class="mea-icon">🚀</span> Publicar
        </button>
        <div class="mea-sep"></div>
        <button class="mea-btn mea-btn-exit" onclick="toggleEdit();closeMobileEditorActions();">
            <span class="mea-icon">✕</span> Sair do Editor
        </button>
    </div>

    <!-- LIGHTBOX -->
    <div id="lightbox" onclick="closeLightbox()">
        <img id="lightbox-img" src="" alt="">
    </div>

    <div class="container">

        <!-- HEADER -->
        <header>
            <div class="header-identity">
                <div class="header-name edit-text" contenteditable="false" data-save-id="header-name">Lucca Tuelher</div>
                <div class="header-role edit-text" contenteditable="false" data-save-id="header-role">Storyboard Artist &amp; Visual Storyteller</div>
            </div>
            <div class="header-right">
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
                        <line x1="3" y1="5" x2="17" y2="5"/>
                        <line x1="3" y1="10" x2="17" y2="10"/>
                        <line x1="3" y1="15" x2="17" y2="15"/>
                    </svg>
                </button>
                <div class="lang-icons">
                    <button class="flag-btn" data-lang="pt" onclick="setLang('pt')" title="Português">🇧🇷</button>
                    <button class="flag-btn" data-lang="en" onclick="setLang('en')" title="English">🇺🇸</button>
                </div>
                <nav>
                    <a onclick="goHome()" class="nav-link active" id="nav-work">
                        <span class="pt-only">Home</span>
                        <span class="en-only">Home</span>
                    </a>
                    <a onclick="goProjects()" class="nav-link" id="nav-projects">
                        <span class="pt-only">Projetos</span>
                        <span class="en-only">Projects</span>
                    </a>
                    <a onclick="goGallery()" class="nav-link" id="nav-gallery">
                        <span class="pt-only">Galeria</span>
                        <span class="en-only">Gallery</span>
                    </a>
                    <a onclick="goBlog()" class="nav-link" id="nav-blog">
                        <span class="pt-only">Notas</span>
                        <span class="en-only">Notes</span>
                    </a>
                    <a onclick="togglePrivate()" class="nav-link private-btn" id="nav-private">
                        <span class="pt-only">Restrito</span>
                        <span class="en-only">Restricted</span>
                    </a>
                    <a onclick="goToContact()" class="nav-link" id="nav-contact">
                        <span class="pt-only">Contato</span>
                        <span class="en-only">Contact</span>
                    </a>
                </nav>
            </div>
        </header>

        <!-- Issue bar -->
        <div class="issue-bar">
            <span class="issue-text pt-only edit-text" contenteditable="false" data-save-id="issue-text-pt">Portfolio — Visual Development &amp; Storyboard</span>
            <span class="issue-text en-only edit-text" contenteditable="false" data-save-id="issue-text-en">Portfolio — Visual Development &amp; Storyboard</span>
        </div>

        <!-- HOME VIEW -->
        <div id="home-view">

            <!-- HERO BANNER -->
            <div class="banner-container">
                <img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1600&q=80" class="banner-img" alt="Banner">
                <div class="banner-text">
                    <div class="banner-label edit-text" contenteditable="false" data-save-id="banner-label">Storyboard & Visual Development</div>
                    <div class="banner-title edit-text" contenteditable="false" data-save-id="banner-title">Selected<br>Work</div>
                </div>
            </div>

            <!-- YOUTUBE EMBED -->
            <div class="home-yt-wrap">
                <div class="embed-area edit-embed">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
                </div>
            </div>

            <!-- FEATURED PROJECT SECTIONS (renderFeatured popula aqui) -->
            <div id="featured-sections"></div>

            <!-- SKETCHBOOK -->
            <div class="section-title" style="margin-top: 80px;">
                <span class="section-label">Sketchbook</span>
                <div class="section-rule"></div>
                <span class="section-num" id="sketch-count">—</span>
            </div>
            <div id="sketch-grid" class="sketch-grid"></div>

            <!-- BANNER DE RODAPÉ -->
            <div class="bottom-banner">
                <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1600&q=80" class="bottom-banner-img editable-img" alt="Bottom Banner">
                <div class="bottom-banner-overlay">
                    <div class="bottom-banner-text edit-text" contenteditable="false" data-save-id="bottom-banner-text">Disponível para projetos freelance</div>
                    <a onclick="goToContact()" class="bottom-banner-cta">
                        <span class="pt-only">Entre em contato →</span>
                        <span class="en-only">Get in touch →</span>
                    </a>
                </div>
            </div>

        </div>

        <!-- PROJECTS VIEW — all projects, with featured picker -->
        <div id="projects-view" class="hidden">
            <div class="section-title" style="margin-top: 3rem;">
                <span class="section-label pt-only">Todos os Projetos</span>
                <span class="section-label en-only">All Projects</span>
                <div class="section-rule"></div>
                <span class="section-num" id="all-proj-count">—</span>
            </div>
            <p id="featured-hint" style="font-family:var(--mono);font-size:0.7rem;color:var(--ink-pale);letter-spacing:0.08em;margin-bottom:28px;" class="editor-only-el">
                Clique em ★ para destacar na Home (máx. 3) / Click ★ to feature on Home (max 3)
            </p>
            <div id="public-grid" class="project-grid"></div>
        </div>

        <!-- GALLERY VIEW -->
        <div id="gallery-view" class="hidden">
            <div class="gallery-header">
                <div>
                    <div class="gallery-h1 pt-only">Galeria de Arte</div>
                    <div class="gallery-h1 en-only">Art Gallery</div>
                </div>
                <div class="gallery-sub edit-text" contenteditable="false">
                    <span class="pt-only">Ilustrações &amp; Processo</span>
                    <span class="en-only">Illustrations &amp; Process</span>
                </div>
            </div>
            <div id="art-gallery-container" class="art-gallery-grid"></div>
        </div>

        <!-- BLOG VIEW -->
        <div id="blog-view" class="hidden">
            <div class="section-title" style="margin-top: 3rem;">
                <span class="section-label pt-only">Notas &amp; Reflexões</span>
                <span class="section-label en-only">Notes &amp; Thoughts</span>
                <div class="section-rule"></div>
                <span class="section-num" id="blog-count">—</span>
            </div>
            <div id="blog-grid-container" class="blog-grid"></div>
        </div>

        <!-- PRIVATE VIEW -->
        <div id="private-view" class="hidden">
            <div class="section-title" style="margin-top: 3rem;">
                <span class="section-label" style="color: var(--accent);">NDA / Restricted</span>
                <div class="section-rule"></div>
                <span class="section-num">🔒</span>
            </div>
            <div id="private-grid" class="project-grid"></div>
        </div>

        <!-- DETAIL VIEW -->
        <div id="detail-view" class="hidden">
            <div onclick="goBack()" class="back-btn">
                ← <span class="pt-only">Voltar</span><span class="en-only">Back</span>
            </div>
            <div id="detail-content" class="detail-container"></div>
        </div>

        <!-- CONTACT VIEW -->
        <div id="contact-view" class="hidden">
            <div class="contact-left">
                <div class="contact-h1 pt-only edit-text" contenteditable="false">Vamos<br>trabalhar<br>juntos.</div>
                <div class="contact-h1 en-only edit-text" contenteditable="false">Let's<br>work<br>together.</div>
                <div class="contact-body edit-text pt-only" contenteditable="false">
                    Disponível para projetos freelance em storyboard, animação e desenvolvimento visual.
                </div>
                <div class="contact-body edit-text en-only" contenteditable="false">
                    Available for freelance projects in storyboard, animation, and visual development.
                </div>
                <a href="/cdn-cgi/l/email-protection#543821373735202131383c3126142d353c3b3b7a373b39" class="contact-email editable-link"><span class="__cf_email__" data-cfemail="d5b9a0b6b6b4a1a0b0b9bdb0a795acb4bdbabafbb6bab8">[email&#160;protected]</span></a>
                <div style="margin-top: 32px;">
                    <a href="cv.pdf" class="btn-cv editable-link" target="_blank">
                        <span class="pt-only">Baixar CV</span>
                        <span class="en-only">Download CV</span>
                    </a>
                </div>
                <div class="social-row" style="margin-top: 24px;">
                    <a href="#" class="social-link editable-link">LinkedIn</a>
                    <a href="#" class="social-link editable-link">Instagram</a>
                    <a href="#" class="social-link editable-link">Behance</a>
                </div>
            </div>
            <div class="contact-right">
                <img src="https://via.placeholder.com/400x533" class="contact-img editable-img" alt="Foto">
            </div>
        </div>

    </div><!-- /container -->

    <!-- EDITOR ACTIVATE PILL (view mode) -->
    <button id="editor-activate" onclick="toggleEdit()">
        <span class="ea-icon">✦</span>
        Editar Site
    </button>

    <!-- DEVICE PREVIEW TOGGLE -->
    <div id="device-toggle">
        <button class="dt-option dt-active" id="dt-desktop" onclick="setDeviceMode('desktop')" title="Visualizar Desktop">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round">
                <rect x="1" y="2" width="14" height="9" rx="1"/>
                <line x1="5" y1="14" x2="11" y2="14"/>
                <line x1="8" y1="11" x2="8" y2="14"/>
            </svg>
            Desktop
        </button>
        <button class="dt-option" id="dt-mobile" onclick="setDeviceMode('mobile')" title="Visualizar Mobile">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round">
                <rect x="4" y="1" width="8" height="14" rx="1.5"/>
                <line x1="7" y1="12.5" x2="9" y2="12.5"/>
            </svg>
            Mobile
        </button>
    </div>

    <!-- EDITOR TOP BAR (edit mode) -->
    <div id="editor-topbar">
        <div class="etb-brand">
            <div class="etb-brand-dot"></div>
            <span class="etb-brand-name"><span>Editor</span> · Lucca Tuelher</span>
        </div>

        <div class="etb-context">
            <span class="etb-context-page" id="etb-page-name">Home</span>
            <span class="etb-editing-badge">Editando</span>
        </div>

        <div class="etb-status">
            <div class="etb-status-dot" id="esb-status-dot"></div>
            <span class="etb-status-label" id="esb-status-text">Salvo</span>
        </div>

        <div class="etb-actions">
            <button class="etb-btn etb-btn-mobile-menu" onclick="openMobileEditorActions()" title="Mais ações">☰ Mais</button>
            <button class="etb-btn" onclick="openSyncModal()" title="Sincronizar via GitHub Gist">
                <span class="sync-dot" id="sync-dot"></span> ☁ Gist Sync
            </button>
            <button class="etb-btn" onclick="exportJSON()" title="Exportar backup .json">↓ Backup</button>
            <button class="etb-btn" onclick="importJSON()" title="Restaurar de .json">↑ Restaurar</button>
            <button class="etb-btn etb-btn-save" onclick="autoSave()" title="Salvar no navegador">💾 Salvar</button>
            <button class="etb-btn etb-btn-publish" onclick="publishSite()" title="Gerar site público">🚀 Publicar</button>
            <button class="etb-btn etb-btn-exit" onclick="toggleEdit()" title="Sair da edição">✕ Sair</button>
        </div>
    </div>

    <!-- ADD PANEL — floating pill at bottom (edit mode) -->
    <div id="editor-add-panel">
        <button class="eap-btn" onclick="addProject('public')" title="Adiciona projeto público com SpeakerDeck">
            + Projeto
        </button>
        <button class="eap-btn eap-btn-accent" onclick="addProject('private')" title="Projeto NDA com vídeo">
            🔒 Privado
        </button>
        <div class="eap-sep"></div>
        <button class="eap-btn" onclick="addPost()">+ Nota</button>
        <button class="eap-btn" onclick="addGalleryItem()">+ Arte</button>
        <button class="eap-btn" onclick="addSketch()">+ Sketch</button>
        <div class="eap-sep"></div>
        <button class="eap-btn" id="eap-txt-btn" onclick="addBlock('text')" title="Dentro de projeto aberto">+ Texto</button>
        <button class="eap-btn" id="eap-img-btn" onclick="addBlock('image')" title="Dentro de projeto aberto">+ Imagem</button>
    </div>

    <!-- RIGHT PANEL — contextual blocks (detail view only) -->
    <div id="editor-right-panel">
        <div class="erp-header">Blocos</div>
        <div class="erp-group">
            <div class="erp-label">Adicionar ao projeto</div>
            <button class="erp-btn" onclick="addBlock('text')">
                <span class="erp-icon">T</span> Bloco de Texto
            </button>
            <button class="erp-btn" onclick="addBlock('image')">
                <span class="erp-icon">⬜</span> Imagem
            </button>
        </div>
        <div class="erp-group">
            <div class="erp-label">Dica</div>
            <div style="font-size:0.58rem;color:rgba(255,255,255,0.2);line-height:1.5;padding:2px 4px;">
                Clique em qualquer texto para editar.<br>
                Clique em qualquer imagem para trocar.<br>
                Clique em ✏ para editar embeds.
            </div>
        </div>
        <div class="erp-group">
            <div class="erp-label">Destaque na Home</div>
            <div style="font-size:0.58rem;color:rgba(255,255,255,0.2);line-height:1.5;padding:2px 4px;">
                Vá em Projetos e clique ★ para escolher até 3 projetos na home.
            </div>
        </div>
    </div>



    <!-- GIST SYNC MODAL -->
    <div id="sync-modal-backdrop">
        <div id="sync-modal">
            <div class="sync-modal-header">
                <span class="sync-modal-title">☁ Sincronizar via GitHub Gist</span>
                <button class="sync-modal-close" onclick="closeSyncModal()">✕ Fechar</button>
            </div>
            <div class="sync-modal-body">

                <div class="sync-section-title">Credenciais</div>

                <div class="sync-field">
                    <label class="sync-label" for="gist-token">
                        GitHub Personal Access Token <span style="color:var(--accent);">*</span>
                    </label>
                    <input type="password" id="gist-token" class="sync-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" autocomplete="off">
                    <div class="sync-hint">
                        Precisa da permissão <strong>gist</strong>.
                        <a href="https://github.com/settings/tokens/new?scopes=gist&description=Portfolio+Sync" target="_blank">Gerar token →</a><br>
                        O token fica salvo apenas no localStorage deste navegador.
                    </div>
                </div>

                <div class="sync-field">
                    <label class="sync-label" for="gist-id">
                        Gist ID <span style="color:var(--ink-pale);">(vazio = criar novo)</span>
                    </label>
                    <input type="text" id="gist-id" class="sync-input" placeholder="a1b2c3d4e5f6... (32 caracteres)">
                    <div class="sync-hint">
                        URL do Gist: gist.github.com/<em>usuario</em>/<strong>ID</strong>
                    </div>
                </div>

                <div class="sync-actions">
                    <button class="sync-btn sync-btn-push" onclick="gistPush()" id="btn-push">↑ Enviar (Push)</button>
                    <button class="sync-btn sync-btn-pull" onclick="gistPull()" id="btn-pull">↓ Receber (Pull)</button>
                </div>

                <div id="sync-status" class="sync-status"></div>

                <hr class="sync-divider">

                <div class="sync-section-title">Estado atual</div>
                <div class="sync-info-grid">
                    <div class="sync-info-item">
                        <div class="sync-info-label">Último push</div>
                        <div class="sync-info-value" id="info-last-push">—</div>
                    </div>
                    <div class="sync-info-item">
                        <div class="sync-info-label">Último pull</div>
                        <div class="sync-info-value" id="info-last-pull">—</div>
                    </div>
                    <div class="sync-info-item">
                        <div class="sync-info-label">Gist ID salvo</div>
                        <div class="sync-info-value" id="info-gist-id">—</div>
                    </div>
                    <div class="sync-info-item">
                        <div class="sync-info-label">Tamanho dos dados</div>
                        <div class="sync-info-value" id="info-data-size">—</div>
                    </div>
                </div>

                <hr class="sync-divider">

                <div class="sync-section-title">Como usar</div>
                <div class="sync-hint" style="line-height:1.9;">
                    <strong>1.</strong> Crie um token no GitHub com permissão <code>gist</code>.<br>
                    <strong>2.</strong> Clique em <strong>Enviar (Push)</strong> → salva os dados em um Gist secreto.<br>
                    <strong>3.</strong> Copie o Gist ID exibido na confirmação.<br>
                    <strong>4.</strong> Em outro computador, cole o token + Gist ID e clique em <strong>Receber (Pull)</strong>.<br>
                    <strong>⚠</strong> Imagens base64 aumentam muito o tamanho. Para imagens grandes, prefira URLs externas (Imgur, Cloudinary).
                </div>

            </div>
        </div>
    </div>

    <input type="file" id="file-input" style="display:none;" accept="image/*">
    <input type="file" id="json-input" style="display:none;" accept=".json">

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ============================================
        // CONSTANTS & STATE
        // ============================================
        const SITE_PASSWORD = "nda";
        let isEditing = false;
        let currentImg = null;
        let currentLang = 'pt';
        let previousView = 'home';

        // DOM refs
        const views = {
            home:     document.getElementById('home-view'),
            projects: document.getElementById('projects-view'),
            blog:     document.getElementById('blog-view'),
            gallery:  document.getElementById('gallery-view'),
            private:  document.getElementById('private-view'),
            detail:   document.getElementById('detail-view'),
            contact:  document.getElementById('contact-view')
        };
        const navs = {
            work:     document.getElementById('nav-work'),
            projects: document.getElementById('nav-projects'),
            blog:     document.getElementById('nav-blog'),
            gallery:  document.getElementById('nav-gallery'),
            private:  document.getElementById('nav-private'),
            contact:  document.getElementById('nav-contact')
        };

        // ============================================
        // INIT
        // ============================================
        function init() {
            // Sketch click handlers (lightbox when not editing)
            function attachSketchHandlers() {
                document.querySelectorAll('.sketch-item img').forEach(img => {
                    img.style.cursor = 'zoom-in';
                    img.onclick = () => openLightbox(img.src);
                });
            }
            attachSketchHandlers();
            window.attachSketchHandlers = attachSketchHandlers;

            // Restore star states from localStorage
            const featured = getFeaturedIds();
            document.querySelectorAll('.star-btn').forEach(btn => {
                const card = btn.closest('.project-card');
                if (card && featured.includes(card.dataset.itemId)) {
                    btn.classList.add('star-on');
                    btn.title = 'Remover destaque';
                }
            });

            renderFeatured();
            updateCounts();
        }

        // ============================================
        // LANGUAGE
        // ============================================
        function setLang(lang) {
            currentLang = lang;
            document.body.className = 'lang-' + lang;
            if (isEditing) document.body.classList.add('editing-mode');
        }

        // ============================================
        // VIEW NAVIGATION
        // ============================================
        function resetViews() {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            Object.values(navs).forEach(n => n.classList.remove('active'));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showView(viewKey, navKey) {
            resetViews();
            views[viewKey].classList.remove('hidden');
            views[viewKey].classList.add('fade-in');
            setTimeout(() => views[viewKey].classList.remove('fade-in'), 500);
            if (navKey && navs[navKey]) navs[navKey].classList.add('active');
            if (isEditing) { document.body.classList.remove('detail-open'); updateTopbarContext(); }
            // Sync mobile nav
            if (typeof updateMobileNav === 'function') updateMobileNav();
            // Scroll to top on mobile
            window.scrollTo(0, 0);
        }

        function goHome()      { showView('home', 'work');         previousView = 'home'; renderFeatured(); updateCounts(); }
        function goProjects()  { showView('projects', 'projects'); previousView = 'projects'; updateCounts(); }
        function goBlog()      { showView('blog', 'blog');         previousView = 'blog'; updateCounts(); }
        function goGallery()   { showView('gallery', 'gallery');   previousView = 'gallery'; }
        function goToContact() { showView('contact', 'contact'); }

        function togglePrivate() {
            if (isEditing) { showView('private', 'private'); previousView = 'private'; return; }
            if (!views.private.classList.contains('hidden')) { goHome(); return; }
            const pass = prompt("Senha / Password:");
            if (pass === SITE_PASSWORD) {
                showView('private', 'private');
                previousView = 'private';
            } else if (pass !== null) {
                alert("Acesso negado.");
            }
        }

        function goBack() {
            if (previousView === 'blog')         goBlog();
            else if (previousView === 'gallery')  goGallery();
            else if (previousView === 'projects') goProjects();
            else if (previousView === 'private')  { showView('private', 'private'); }
            else goHome();
        }

        // ============================================
        // FEATURED PROJECTS (Home shows max 3)
        // ============================================

        // Returns array of featured project IDs (stored in localStorage)
        function getFeaturedIds() {
            try { return JSON.parse(localStorage.getItem('portfolio_featured') || '[]'); }
            catch(e) { return []; }
        }
        function saveFeaturedIds(ids) {
            localStorage.setItem('portfolio_featured', JSON.stringify(ids));
        }

        // Toggle featured state of a project card
        function toggleFeatured(id, btn) {
            let featured = getFeaturedIds();
            if (featured.includes(id)) {
                featured = featured.filter(f => f !== id);
                btn.classList.remove('star-on');
                btn.title = 'Destacar na Home';
            } else {
                if (featured.length >= 3) {
                    alert('Máximo 3 projetos em destaque na Home.\nRemova um antes de adicionar outro.');
                    return;
                }
                featured.push(id);
                btn.classList.add('star-on');
                btn.title = 'Remover destaque';
            }
            saveFeaturedIds(featured);
            renderFeatured();
            updateCounts();
        }

        // Rebuild the Home featured sections from the full public-grid
        function renderFeatured() {
            const sectionsEl = document.getElementById('featured-sections');
            if (!sectionsEl) return;
            const featured   = getFeaturedIds();
            const allCards   = Array.from(document.querySelectorAll('#public-grid .project-card'));

            const toShow = featured.length > 0
                ? allCards.filter(c => featured.includes(c.dataset.itemId))
                : allCards.slice(0, 3);

            sectionsEl.innerHTML = '';

            toShow.forEach((card, idx) => {
                const id      = card.dataset.itemId;
                const thumbSrc= card.querySelector('.card-thumb')?.src || '';
                const titlePT = card.querySelector('.card-title.pt-only')?.textContent.trim() || 'Projeto';
                const titleEN = card.querySelector('.card-title.en-only')?.textContent.trim()  || 'Project';
                const tagPT   = card.querySelector('.card-tag.pt-only')?.textContent.trim()    || '';
                const tagEN   = card.querySelector('.card-tag.en-only')?.textContent.trim()    || '';
                const sdSrc   = card.dataset.sdSrc || '';
                // Get 3 preview images (stored in card dataset as JSON array)
                let previewImgs = [];
                try { previewImgs = JSON.parse(card.dataset.previewImgs || '[]'); } catch(e) {}
                // Pad to 3
                while (previewImgs.length < 3) previewImgs.push('');

                const num = String(idx + 1).padStart(2, '0');

                const embedContent = sdSrc
                    ? `<iframe src="${sdSrc}" allowfullscreen scrolling="no" allow="autoplay; fullscreen"></iframe>`
                    : `<div class="hps-embed-placeholder">
                           <div style="font-size:1.6rem;margin-bottom:8px;opacity:0.25;">▶</div>
                           <div class="pt-only" style="font-size:0.6rem;">Editar → clique em ✏ Embed</div>
                           <div class="en-only"  style="font-size:0.6rem;">Edit → click ✏ Embed</div>
                       </div>`;

                const imgItems = previewImgs.map((src, i) => {
                    const placeholder = 'https://via.placeholder.com/400x300/e8e4db/a09c93';
                    return `<div class="hps-img-item" data-proj-id="${id}" data-img-idx="${i}">
                        <img src="${src || placeholder}" class="hps-preview-img" alt="">
                    </div>`;
                }).join('');

                const section = document.createElement('div');
                section.className = 'home-proj-section';
                section.dataset.itemId = id;

                section.innerHTML = `
                    <!-- TOP: title + subtitle -->
                    <div class="hps-top">
                        <div class="hps-left">
                            <div class="hps-index">${num}</div>
                            <div class="hps-tag pt-only">${tagPT}</div>
                            <div class="hps-tag en-only">${tagEN}</div>
                            <div class="hps-title pt-only">${titlePT}</div>
                            <div class="hps-title en-only">${titleEN}</div>
                            <div class="hps-subtitle edit-text pt-only" contenteditable="false" data-save-id="hps-sub-pt-${id}">Subtítulo ou descrição breve do projeto.</div>
                            <div class="hps-subtitle edit-text en-only" contenteditable="false" data-save-id="hps-sub-en-${id}">Brief project subtitle or description.</div>
                        </div>
                    </div>
                    <!-- SPEAKERDECK -->
                    <div class="hps-embed-wrap">
                        <div class="hps-embed-label">SpeakerDeck / Embed</div>
                        <div class="hps-embed edit-sd-embed" data-proj-id="${id}">${embedContent}</div>
                    </div>
                    <!-- 3 IMAGES -->
                    <div class="hps-images" data-proj-id="${id}">${imgItems}</div>
                    <!-- LINK -->
                    <div class="hps-footer">
                        <a class="hps-link" data-item-id="${id}">
                            <span class="pt-only">Ver projeto →</span>
                            <span class="en-only">View project →</span>
                        </a>
                    </div>`;

                sectionsEl.appendChild(section);
            });

            if (isEditing) enableEditing(true);
        }

        function openItem(id) {
            const contentDiv = document.getElementById('detail-content');
            const source = document.getElementById('data-' + id);
            if (!source) return;
            resetViews();
            views.detail.classList.remove('hidden');
            contentDiv.innerHTML = '';
            source.classList.remove('hidden');
            contentDiv.appendChild(source);
            if (isEditing) { document.body.classList.add('detail-open'); updateTopbarContext(); enableEditing(true); }
        }

        // ============================================
        // LIGHTBOX
        // ============================================
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.add('open');
        }
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('open');
        }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

        // ============================================
        // COUNTS
        // ============================================
        function updateCounts() {
            const allProjCount   = document.querySelectorAll('#public-grid .project-card').length;
            const sketchCount    = document.querySelectorAll('#sketch-grid .sketch-item').length;
            const blogCount      = document.querySelectorAll('#blog-grid-container .blog-item').length;

            const apc = document.getElementById('all-proj-count');
            const sc  = document.getElementById('sketch-count');
            const bc  = document.getElementById('blog-count');

            if (apc) apc.textContent = allProjCount > 0 ? String(allProjCount).padStart(2,'0') : '—';
            if (sc)  sc.textContent  = sketchCount  > 0 ? String(sketchCount).padStart(2,'0')  : '—';
            if (bc)  bc.textContent  = blogCount     > 0 ? String(blogCount).padStart(2,'0')    : '—';

            // proj-count on home is set by renderFeatured()
        }

        // ============================================
        // EDITOR
        // ============================================
        function toggleEdit() {
            isEditing = !isEditing;
            if (isEditing) {
                document.body.classList.add('editing-mode');
                enableEditing(true);
                updateTopbarContext();
                setEditorStatus('saved');
            } else {
                document.body.classList.remove('editing-mode');
                document.body.classList.remove('detail-open');
                enableEditing(false);
                autoSave();
            }
        }

        function setEditorStatus(state, msg) {
            const dot  = document.getElementById('esb-status-dot');
            const text = document.getElementById('esb-status-text');
            if (!dot || !text) return;
            dot.className = 'etb-status-dot';
            if (state === 'saving') {
                dot.classList.add('pending');
                text.textContent = msg || 'Salvando…';
            } else if (state === 'saved') {
                text.textContent = msg || 'Salvo';
            } else if (state === 'error') {
                dot.classList.add('error');
                text.textContent = msg || 'Erro ao salvar';
            }
        }

        function updateTopbarContext() {
            const label = document.getElementById('etb-page-name');
            if (!label) return;
            const active = document.querySelector('nav .nav-link.active');
            const isDetail = !views.detail.classList.contains('hidden');
            if (isDetail) {
                const title = document.querySelector('#detail-content .detail-title');
                label.textContent = title ? (title.textContent.trim() || 'Projeto') : 'Projeto';
                document.body.classList.add('detail-open');
            } else {
                label.textContent = active ? active.textContent.trim() : 'Home';
                document.body.classList.remove('detail-open');
            }
        }

        function enableEditing(enable) {
            // ---- Text ----
            document.querySelectorAll('.edit-text').forEach(el => {
                el.contentEditable = enable;
            });

            // ---- Images (skip sketch items — handled separately) ----
            document.querySelectorAll('img').forEach(img => {
                if (img.closest('.sketch-item')) return; // skip sketch
                if (enable) {
                    img.classList.add('editable-img');
                    img.onclick = () => uploadImg(img);
                } else {
                    img.classList.remove('editable-img');
                    img.onclick = null;
                }
            });

            // ---- Sketch images: upload in edit mode, lightbox otherwise ----
            document.querySelectorAll('.sketch-item img').forEach(img => {
                img.style.cursor = enable ? 'pointer' : 'zoom-in';
                img.onclick = enable
                    ? (e) => { e.stopPropagation(); uploadImg(img); }
                    : () => openLightbox(img.src);
            });

            // ---- Detail-page video embeds (edit-embed) ----
            document.querySelectorAll('.edit-embed').forEach(div => {
                let btn = div.parentElement.querySelector('.embed-edit-btn');
                if (enable) {
                    div.style.outline = '2px dashed rgba(45,90,142,0.4)';
                    if (!btn) {
                        btn = document.createElement('button');
                        btn.className = 'embed-edit-btn';
                        btn.innerHTML = '✏ Editar vídeo';
                        btn.onclick = () => promptEmbed(div);
                        div.parentElement.appendChild(btn);
                    }
                    btn.style.display = 'flex';
                } else {
                    div.style.outline = '';
                    if (btn) btn.style.display = 'none';
                }
            });

            // ---- Home YouTube embed ----
            const ytDiv = document.querySelector('.home-yt-wrap .edit-embed');
            if (ytDiv) {
                let ytBtn = document.querySelector('.home-yt-wrap .embed-edit-btn');
                if (enable) {
                    ytDiv.style.outline = '2px dashed rgba(45,90,142,0.4)';
                    if (!ytBtn) {
                        ytBtn = document.createElement('button');
                        ytBtn.className = 'embed-edit-btn';
                        ytBtn.innerHTML = '✏ Editar vídeo';
                        ytBtn.onclick = () => promptEmbed(ytDiv);
                        document.querySelector('.home-yt-wrap').appendChild(ytBtn);
                    }
                    ytBtn.style.display = 'flex';
                } else {
                    ytDiv.style.outline = '';
                    if (ytBtn) ytBtn.style.display = 'none';
                }
            }

            // ---- Home section SpeakerDeck embeds ----
            document.querySelectorAll('.hps-embed.edit-sd-embed').forEach(div => {
                let btn = div.parentElement.querySelector('.sd-edit-btn');
                if (enable) {
                    div.style.outline = '2px dashed rgba(45,90,142,0.4)';
                    if (!btn) {
                        btn = document.createElement('button');
                        btn.className = 'embed-edit-btn sd-edit-btn';
                        btn.style.cssText = 'top:6px;right:6px;';
                        btn.innerHTML = '✏ Embed';
                        btn.onclick = () => promptSdEmbed(div);
                        div.parentElement.style.position = 'relative';
                        div.parentElement.appendChild(btn);
                    }
                    btn.style.display = 'flex';
                } else {
                    div.style.outline = '';
                    if (btn) btn.style.display = 'none';
                }
            });

            // ---- Home section 3 preview images ----
            document.querySelectorAll('.hps-img-item img.hps-preview-img').forEach(img => {
                if (enable) {
                    img.classList.add('editable-img');
                    img.onclick = (e) => {
                        e.stopPropagation();
                        const item    = img.closest('.hps-img-item');
                        const projId  = item?.dataset.projId;
                        const imgIdx  = parseInt(item?.dataset.imgIdx ?? -1);
                        currentImg = img;
                        // After upload we also save to card dataset
                        window._pendingImgMeta = { projId, imgIdx };
                        document.getElementById('file-input').click();
                    };
                } else {
                    img.classList.remove('editable-img');
                    img.onclick = () => openLightbox(img.src);
                }
            });

            // ---- Bottom banner image ----
            const bbImg = document.querySelector('.bottom-banner .bottom-banner-img');
            if (bbImg) {
                if (enable) {
                    bbImg.style.outline = '2px dashed rgba(45,90,142,0.4)';
                    bbImg.style.cursor = 'pointer';
                    bbImg.onclick = () => uploadImg(bbImg);
                } else {
                    bbImg.style.outline = '';
                    bbImg.style.cursor = '';
                    bbImg.onclick = null;
                }
            }

            // ---- Delete buttons ----
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.style.display = enable ? 'block' : 'none';
            });

            // ---- Editable links ----
            document.querySelectorAll('.editable-link').forEach(link => {
                if (enable) {
                    link.classList.add('editing');
                    link.onclick = e => {
                        e.preventDefault();
                        const newUrl = prompt("Novo URL:", link.href || link.getAttribute('href'));
                        if (newUrl !== null) link.href = newUrl;
                    };
                } else {
                    link.classList.remove('editing');
                    link.onclick = null;
                }
            });
        }

        function promptEmbed(div) {
            const current = div.querySelector('iframe')?.src || '';
            const code = prompt("Cole a URL do YouTube ou embed code:", current);
            if (!code) return;
            if (code.includes('<iframe')) {
                div.innerHTML = code;
            } else {
                const src = code
                    .replace('watch?v=', 'embed/')
                    .replace('youtu.be/', 'www.youtube.com/embed/');
                div.innerHTML = `<iframe src="${src}" allowfullscreen></iframe>`;
            }
            autoSave();
        }

        function promptSdEmbed(div) {
            const projId = div.dataset.projId;
            const currentIframe = div.querySelector('iframe');
            const current = currentIframe?.src || '';
            const code = prompt(
                "Cole a URL ou embed code do SpeakerDeck:\n\nExemplo URL: https://speakerdeck.com/player/abc123\nOu cole o <iframe> do SpeakerDeck completo",
                current
            );
            if (code === null) return; // cancelled
            if (!code.trim()) {
                // Clear embed
                div.innerHTML = `<div class="hps-embed-placeholder"><div style="font-size:1.4rem;margin-bottom:8px;opacity:0.3;">▶</div><div>Sem embed</div></div>`;
                if (projId) updateCardSdSrc(projId, '');
                autoSave();
                return;
            }
            if (code.includes('<iframe') || code.includes('<script')) {
                div.innerHTML = code;
            } else {
                // Treat as URL — convert various SpeakerDeck formats
                let src = code.trim();
                // speakerdeck.com/username/slug → player URL
                if (src.includes('speakerdeck.com') && !src.includes('/player/')) {
                    const m = src.match(/speakerdeck\.com\/[^/]+\/([^/?#]+)/);
                    if (m) src = `https://speakerdeck.com/player/${m[1]}`;
                }
                div.innerHTML = `<iframe src="${src}" allowfullscreen scrolling="no" allow="autoplay; fullscreen"></iframe>`;
            }
            if (projId) updateCardSdSrc(projId, div.querySelector('iframe')?.src || '');
            autoSave();
        }

        // Saves the SpeakerDeck src back to the source project card so it persists
        function updateCardSdSrc(projId, src) {
            const card = document.querySelector(`#public-grid .project-card[data-item-id="${projId}"]`);
            if (card) card.dataset.sdSrc = src;
        }

        // ============================================
        // IMAGE UPLOAD
        // ============================================
        function uploadImg(imgEl) {
            if (!isEditing) return;
            currentImg = imgEl;
            document.getElementById('file-input').click();
        }

        document.getElementById('file-input').addEventListener('change', function (e) {
            if (!e.target.files || !e.target.files[0]) return;
            const reader = new FileReader();
            reader.onload = ev => {
                if (currentImg) {
                    currentImg.src = ev.target.result;
                    // If this is a home section preview image, save back to the card
                    const meta = window._pendingImgMeta;
                    if (meta && meta.projId && meta.imgIdx >= 0) {
                        const card = document.querySelector(`#public-grid .project-card[data-item-id="${meta.projId}"]`);
                        if (card) {
                            let imgs = [];
                            try { imgs = JSON.parse(card.dataset.previewImgs || '[]'); } catch(e2) {}
                            while (imgs.length < 3) imgs.push('');
                            imgs[meta.imgIdx] = ev.target.result;
                            card.dataset.previewImgs = JSON.stringify(imgs);
                        }
                        window._pendingImgMeta = null;
                    }
                }
                autoSave();
            };
            reader.readAsDataURL(e.target.files[0]);
            this.value = '';
        });

        // ============================================
        // CONTENT CREATION
        // ============================================
        function createDataWrapper(id, innerHTML) {
            const div = document.createElement('div');
            div.id = `data-${id}`;
            div.className = 'hidden';
            div.innerHTML = innerHTML;
            document.body.appendChild(div);
            return div;
        }

        function addProject(type) {
            const id = 'proj_' + Date.now();
            const grid = type === 'public'
                ? document.getElementById('public-grid')
                : document.getElementById('private-grid');

            const card = document.createElement('div');
            card.className = 'project-card';
            card.dataset.itemId = id;
            card.innerHTML = `
                <button class="delete-btn" onclick="event.stopPropagation(); this.closest('.project-card').remove(); const d=document.getElementById('data-${id}'); if(d) d.remove(); saveFeaturedIds(getFeaturedIds().filter(x=>x!=='${id}')); renderFeatured(); updateCounts();">DEL</button>
                ${type === 'public' ? `<button class="star-btn" onclick="event.stopPropagation(); toggleFeatured('${id}', this);" title="Destacar na Home">★</button>` : ''}
                <div class="card-thumb-wrap">
                    <img src="https://via.placeholder.com/600x450/e8e4db/5a574f" class="card-thumb">
                </div>
                <div class="card-tag edit-text pt-only" contenteditable="true">Categoria</div>
                <div class="card-tag edit-text en-only" contenteditable="true">Category</div>
                <h4 class="card-title edit-text pt-only" contenteditable="true">Novo Projeto</h4>
                <h4 class="card-title edit-text en-only" contenteditable="true">New Project</h4>
                <span class="card-arrow">→</span>`;
            grid.appendChild(card);

            const detailEmbed = type === 'private'
                ? `<div class="embed-wrapper" style="margin-bottom:28px;">
                    <div class="embed-area edit-embed" style="aspect-ratio:16/9; display:flex; align-items:center; justify-content:center;">
                        <span style="color:#888; font-family:var(--mono); font-size:0.7rem; letter-spacing:0.1em;">[ Ative edição → clique ✏ Editar vídeo ]</span>
                    </div>
                   </div>`
                : `<div class="hps-embed-wrap" style="margin-bottom:28px;">
                    <div class="hps-embed-label">SpeakerDeck</div>
                    <div class="hps-embed edit-sd-embed" data-proj-id="${id}" style="aspect-ratio:16/9; display:flex; align-items:center; justify-content:center;">
                        <div class="hps-embed-placeholder"><div style="font-size:1.4rem;margin-bottom:8px;opacity:0.3;">▶</div><div style="font-size:0.6rem;">Ative edição → clique ✏ Embed</div></div>
                    </div>
                   </div>`;

            createDataWrapper(id, `
                <div class="detail-header">
                    <div class="detail-tag edit-text" contenteditable="true">Storyboard</div>
                    <div class="detail-title edit-text pt-only" contenteditable="true">Título do Projeto</div>
                    <div class="detail-title edit-text en-only" contenteditable="true">Project Title</div>
                    <div class="detail-desc edit-text pt-only" contenteditable="true">Descrição curta do projeto, contexto e objetivos.</div>
                    <div class="detail-desc edit-text en-only" contenteditable="true">Short description of the project, context and goals.</div>
                    <div class="detail-meta">
                        <div class="meta-item"><div class="meta-label">Ano</div><div class="meta-value edit-text" contenteditable="true">2025</div></div>
                        <div class="meta-item"><div class="meta-label">Cliente</div><div class="meta-value edit-text" contenteditable="true">—</div></div>
                        <div class="meta-item"><div class="meta-label">Tipo</div><div class="meta-value edit-text" contenteditable="true">Storyboard</div></div>
                    </div>
                </div>
                ${detailEmbed}
                <div class="generic-block">
                    <button class="delete-btn" onclick="this.parentElement.remove();">DEL</button>
                    <img src="https://via.placeholder.com/1200x700/e8e4db/5a574f" class="generic-img editable-img">
                </div>`);

            updateCounts();
            renderFeatured();
            if (isEditing) enableEditing(true);
        }

        // Event delegation — works even after contenteditable rename
        document.addEventListener('click', function(e) {
            if (isEditing) return;
            // Project/blog cards in grid
            const card = e.target.closest('.project-card[data-item-id], .blog-item[data-item-id]');
            if (card) { openItem(card.dataset.itemId); return; }
            // "Ver projeto completo" link in home sections
            const hpsLink = e.target.closest('.hps-link[data-item-id]');
            if (hpsLink) { openItem(hpsLink.dataset.itemId); return; }
            // Click on the right thumb of a home section opens project
            const hpsRight = e.target.closest('.hps-right');
            if (hpsRight) {
                const section = hpsRight.closest('.home-proj-section[data-item-id]');
                if (section) openItem(section.dataset.itemId);
            }
        });

        function addPost() {
            const id = 'post_' + Date.now();
            const grid = document.getElementById('blog-grid-container');

            const item = document.createElement('div');
            item.className = 'blog-item';
            item.dataset.itemId = id;
            item.innerHTML = `
                <button class="delete-btn" onclick="event.stopPropagation(); this.parentElement.remove(); const d=document.getElementById('data-${id}'); if(d) d.remove(); updateCounts();">DEL</button>
                <span class="blog-date edit-text" contenteditable="true">01 JAN 2025</span>
                <img src="https://via.placeholder.com/600x338/e8e4db/5a574f" class="blog-thumb editable-img">
                <div class="blog-title edit-text pt-only" contenteditable="true">Título da Nota</div>
                <div class="blog-title edit-text en-only" contenteditable="true">Note Title</div>
                <div class="blog-excerpt edit-text pt-only" contenteditable="true">Resumo breve do post...</div>
                <div class="blog-excerpt edit-text en-only" contenteditable="true">Brief excerpt...</div>`;
            grid.prepend(item);

            createDataWrapper(id, `
                <div class="detail-header">
                    <div class="detail-tag edit-text" contenteditable="true">Nota</div>
                    <div class="detail-title edit-text pt-only" contenteditable="true">Título Completo</div>
                    <div class="detail-title edit-text en-only" contenteditable="true">Full Title</div>
                    <div class="detail-desc edit-text pt-only" contenteditable="true">Texto introdutório...</div>
                    <div class="detail-desc edit-text en-only" contenteditable="true">Introductory text...</div>
                </div>
                <div class="generic-block">
                    <button class="delete-btn" onclick="this.parentElement.remove();">DEL</button>
                    <img src="https://via.placeholder.com/1200x700/e8e4db/5a574f" class="generic-img editable-img">
                </div>
                <div class="generic-block">
                    <button class="delete-btn" onclick="this.parentElement.remove();">DEL</button>
                    <div class="generic-text edit-text" contenteditable="true">Conteúdo do post. Clique para editar.</div>
                </div>`);

            updateCounts();
            if (isEditing) enableEditing(true);
        }

        function addGalleryItem() {
            const grid = document.getElementById('art-gallery-container');
            const item = document.createElement('div');
            item.className = 'art-item';
            item.innerHTML = `
                <button class="delete-btn" onclick="this.parentElement.remove();">DEL</button>
                <img src="https://via.placeholder.com/400x550/e8e4db/5a574f" class="art-img editable-img">
                <div class="art-caption edit-text pt-only" contenteditable="true">Descrição</div>
                <div class="art-caption edit-text en-only" contenteditable="true">Caption</div>`;
            grid.appendChild(item);
            if (isEditing) enableEditing(true);
        }

        function addSketch() {
            const grid = document.getElementById('sketch-grid');
            const item = document.createElement('div');
            item.className = 'sketch-item';
            item.innerHTML = `
                <button class="delete-btn" onclick="this.parentElement.remove(); updateCounts();">DEL</button>
                <img src="https://via.placeholder.com/400x400/e8e4db/5a574f">`;
            grid.appendChild(item);
            // In edit mode the new img gets upload handler; in view mode lightbox
            if (isEditing) {
                const img = item.querySelector('img');
                img.style.cursor = 'pointer';
                img.onclick = (e) => { e.stopPropagation(); uploadImg(img); };
            }
            updateCounts();
        }

        // ============================================
        // FREE BLOCKS — arrastar, redimensionar, editar
        // ============================================

        let _fbDragging = null, _fbResizing = null;
        let _fbOx = 0, _fbOy = 0, _fbOw = 0, _fbOh = 0, _fbOmx = 0, _fbOmy = 0;
        let _fbSelected = null;

        // Retorna a view visível no momento
        function getActiveView() {
            return Object.values(views).find(v => v && !v.classList.contains('hidden')) || null;
        }

        // Desseleciona todos os blocos
        function deselectAllBlocks() {
            document.querySelectorAll('.free-block.fb-selected').forEach(b => {
                b.classList.remove('fb-selected');
            });
            _fbSelected = null;
        }

        // Clique fora deseleciona
        document.addEventListener('mousedown', function(e) {
            if (!isEditing) return;
            if (!e.target.closest('.free-block') && !e.target.closest('.fb-toolbar')) {
                deselectAllBlocks();
            }
        });

        // Mouse move global — drag e resize
        document.addEventListener('mousemove', function(e) {
            if (_fbDragging) {
                const view = _fbDragging.closest('[id$="-view"], [id^="detail-content"]');
                if (!view) return;
                const vr = view.getBoundingClientRect();
                let x = e.clientX - _fbOx - vr.left;
                let y = e.clientY - _fbOy - vr.top + view.scrollTop;
                // Snap suave às bordas do container
                x = Math.max(0, x);
                y = Math.max(0, y);
                _fbDragging.style.left = x + 'px';
                _fbDragging.style.top  = y + 'px';
            }
            if (_fbResizing) {
                const dx = e.clientX - _fbOmx;
                const dy = e.clientY - _fbOmy;
                const nw = Math.max(120, _fbOw + dx);
                const nh = Math.max(60,  _fbOh + dy);
                _fbResizing.style.width  = nw + 'px';
                _fbResizing.style.height = (_fbResizing.dataset.type === 'text' ? 'auto' : nh + 'px');
                if (_fbResizing.dataset.type === 'text') {
                    _fbResizing.querySelector('.fb-content').style.minHeight = nh + 'px';
                }
            }
        });

        document.addEventListener('mouseup', function() {
            _fbDragging = null;
            _fbResizing = null;
            document.body.style.userSelect = '';
            document.body.style.cursor = '';
        });

        // Cria um bloco livre e o insere na view ativa
        function addBlock(type) {
            if (!isEditing) return;

            const view = getActiveView();
            if (!view) return;

            // Posição inicial: centro visível da view
            const vr = view.getBoundingClientRect();
            const scrollY = view.scrollTop || 0;
            const startX = Math.max(0, (vr.width  - 360) / 2);
            const startY = Math.max(0, scrollY + (vr.height - 240) / 2 - vr.top);

            const block = document.createElement('div');
            block.className = 'free-block fb-' + type;
            block.dataset.type = type;
            block.style.left   = startX + 'px';
            block.style.top    = startY + 'px';
            block.style.width  = (type === 'text' ? '380px' : '480px');
            block.style.height = (type === 'text' ? 'auto'  : '300px');

            // Toolbar
            const toolbar = document.createElement('div');
            toolbar.className = 'fb-toolbar';
            toolbar.innerHTML = `
                <span class="fb-tool fb-drag-handle" title="Arrastar">⠿</span>
                ${type === 'text' ? `
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-fmt" data-cmd="bold"       title="Negrito"><b>B</b></button>
                <button class="fb-tool fb-fmt" data-cmd="italic"     title="Itálico"><i>I</i></button>
                <button class="fb-tool fb-fmt" data-cmd="underline"  title="Sublinhado"><u>U</u></button>
                <span class="fb-tool fb-sep"></span>
                <select class="fb-tool fb-size" title="Tamanho">
                    <option value="0.8rem">XS</option>
                    <option value="1rem" selected>S</option>
                    <option value="1.3rem">M</option>
                    <option value="1.8rem">L</option>
                    <option value="2.6rem">XL</option>
                    <option value="3.6rem">XXL</option>
                </select>
                <select class="fb-tool fb-font" title="Fonte">
                    <option value="var(--sans)"  selected>Sans</option>
                    <option value="var(--serif)">Serif</option>
                    <option value="var(--mono)">Mono</option>
                </select>
                ` : `
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-img-upload" title="Trocar imagem">🖼 Trocar</button>
                `}
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-del" title="Excluir">✕</button>`;

            // Content
            const content = document.createElement('div');
            content.className = 'fb-content';

            if (type === 'text') {
                content.contentEditable = 'true';
                content.innerHTML = 'Clique para editar...';
                content.style.fontFamily = 'var(--sans)';
                content.style.fontSize   = '1rem';
                // Prevent drag on text selection
                content.addEventListener('mousedown', e => e.stopPropagation());
            } else {
                const img = document.createElement('img');
                img.src = 'https://via.placeholder.com/480x300/e8e4db/a09c93';
                img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;';
                content.appendChild(img);
                content.style.height = '100%';
            }

            // Resize handle
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'fb-resize';
            resizeHandle.title = 'Redimensionar';
            resizeHandle.innerHTML = '⤡';

            block.appendChild(toolbar);
            block.appendChild(content);
            block.appendChild(resizeHandle);

            // ---- Event: selecionar ----
            block.addEventListener('mousedown', function(e) {
                if (e.target.closest('.fb-toolbar') || e.target.closest('.fb-resize')) return;
                deselectAllBlocks();
                block.classList.add('fb-selected');
                _fbSelected = block;
            });

            // ---- Event: drag handle ----
            toolbar.querySelector('.fb-drag-handle').addEventListener('mousedown', function(e) {
                e.preventDefault();
                deselectAllBlocks();
                block.classList.add('fb-selected');
                _fbSelected = block;
                _fbDragging = block;
                const r = block.getBoundingClientRect();
                _fbOx = e.clientX - r.left;
                _fbOy = e.clientY - r.top;
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'grabbing';
            });

            // ---- Event: resize ----
            resizeHandle.addEventListener('mousedown', function(e) {
                e.preventDefault();
                e.stopPropagation();
                _fbResizing = block;
                _fbOw  = block.offsetWidth;
                _fbOh  = block.offsetHeight;
                _fbOmx = e.clientX;
                _fbOmy = e.clientY;
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'nwse-resize';
            });

            // ---- Event: delete ----
            toolbar.querySelector('.fb-del').addEventListener('click', function(e) {
                e.stopPropagation();
                if (confirm('Excluir este bloco?')) block.remove();
            });

            // ---- Event: text formatting ----
            if (type === 'text') {
                toolbar.querySelectorAll('.fb-fmt').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        content.focus();
                        document.execCommand(this.dataset.cmd, false, null);
                    });
                });

                toolbar.querySelector('.fb-size').addEventListener('change', function() {
                    content.style.fontSize = this.value;
                });

                toolbar.querySelector('.fb-font').addEventListener('change', function() {
                    content.style.fontFamily = this.value;
                });
            }

            // ---- Event: image upload ----
            if (type === 'image') {
                toolbar.querySelector('.fb-img-upload').addEventListener('click', function(e) {
                    e.stopPropagation();
                    currentImg = content.querySelector('img');
                    document.getElementById('file-input').click();
                });
            }

            // Inserir na view — usa position relative como base
            view.style.position = 'relative';
            view.appendChild(block);

            // Selecionar imediatamente
            deselectAllBlocks();
            block.classList.add('fb-selected');
            _fbSelected = block;

            if (type === 'text') {
                setTimeout(() => { content.focus(); selectAll(content); }, 50);
            }
        }

        function selectAll(el) {
            const range = document.createRange();
            range.selectNodeContents(el);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        }

        // ============================================
        // PUBLISH — gera site público limpo
        // ============================================

        function publishSite() {
            // Reset to desktop mode before publishing
            if (currentDeviceMode === 'mobile') setDeviceMode('desktop');
            if (isEditing) toggleEdit();

            // Bake featured state into cards as data-featured attribute before clone
            const featuredIds = getFeaturedIds();
            document.querySelectorAll('#public-grid .project-card[data-item-id]').forEach(card => {
                card.dataset.featured = featuredIds.includes(card.dataset.itemId) ? 'true' : 'false';
            });

            // Certifica que todos os dados estão no DOM
            const detailContent = document.getElementById('detail-content');
            if (detailContent && detailContent.children.length) {
                Array.from(detailContent.children).forEach(child => {
                    child.classList.add('hidden');
                    document.body.appendChild(child);
                });
            }

            // Clona o documento inteiro em memória
            const doc = document.cloneNode(true);

            // ---- 1. Remover seção privada e link ----
            const privateView = doc.getElementById('private-view');
            if (privateView) privateView.remove();

            const navPrivate = doc.getElementById('nav-private');
            if (navPrivate) navPrivate.remove();

            // Remove private link from mobile nav
            doc.querySelectorAll('[data-mobile-nav="private"]').forEach(el => {
                const sep = el.previousElementSibling;
                if (sep && sep.classList.contains('mobile-nav-sep')) sep.remove();
                el.remove();
            });

            // ---- 2. Remover editor panel ----
            const editorPanel = doc.getElementById('editor-panel');
            if (editorPanel) editorPanel.remove();

            // ---- 3. Remover modal de sync ----
            const syncModal = doc.getElementById('sync-modal-backdrop');
            if (syncModal) syncModal.remove();

            // ---- 3b. Remover editor-only elements ----
            ['editor-activate', 'editor-topbar', 'editor-add-panel', 'editor-right-panel', 'mea-overlay', 'mea-drawer', 'phone-frame', 'device-toggle'].forEach(id => {
                const el = doc.getElementById(id);
                if (el) el.remove();
            });

            // ---- 4. Remover inputs hidden (file, json) ----
            doc.querySelectorAll('#file-input, #json-input').forEach(el => el.remove());

            // ---- 4b. Converter free-blocks em elementos estáticos (sem toolbar/resize) ----
            doc.querySelectorAll('.free-block').forEach(block => {
                block.querySelector('.fb-toolbar')?.remove();
                block.querySelector('.fb-resize')?.remove();
                block.classList.remove('fb-selected');
                // Remove edit affordances, keep visual position
                if (block.dataset.type === 'text') {
                    const c = block.querySelector('.fb-content');
                    if (c) c.removeAttribute('contenteditable');
                }
            });

            // ---- 5. Limpar atributos de edição em todo conteúdo ----
            doc.querySelectorAll('[contenteditable]').forEach(el => {
                el.removeAttribute('contenteditable');
            });
            doc.querySelectorAll('.edit-text').forEach(el => {
                el.classList.remove('edit-text');
            });
            doc.querySelectorAll('.editable-img').forEach(el => {
                el.classList.remove('editable-img');
            });
            doc.querySelectorAll('.editable-link').forEach(el => {
                el.classList.remove('editable-link');
            });
            doc.querySelectorAll('.edit-embed').forEach(el => {
                el.classList.remove('edit-embed');
            });

            // ---- 6. Remover botões de delete ----
            doc.querySelectorAll('.delete-btn').forEach(el => el.remove());

            // ---- 7. Remover onclick inline de edição de embed ----
            // (os onclick de navegação como openItem, goHome, etc. devem permanecer)

            // ---- 8. Mostrar home, esconder outras views ----
            const viewIds = ['home-view', 'projects-view', 'blog-view', 'gallery-view', 'detail-view', 'contact-view'];
            viewIds.forEach(id => {
                const el = doc.getElementById(id);
                if (!el) return;
                if (id === 'home-view') el.classList.remove('hidden');
                else el.classList.add('hidden');
            });

            // ---- 9. Reset nav: só work ativo ----
            doc.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            const navWork = doc.getElementById('nav-work');
            if (navWork) navWork.classList.add('active');

            // ---- 10. Remover todo CSS do editor do <style> ----
            const styleBlocks = doc.querySelectorAll('style');
            styleBlocks.forEach(styleEl => {
                styleEl.textContent = stripEditorCSS(styleEl.textContent);
            });

            // ---- 11. Substituir o <script> inteiro pelo script público mínimo ----
            doc.querySelectorAll('script').forEach(el => el.remove());

            const publicScript = doc.createElement('script');
            publicScript.textContent = buildPublicScript();
            doc.body.appendChild(publicScript);

            // ---- 12. Ajustar padding-bottom do body (remover espaço do editor) ----
            const bodyEl = doc.body;
            bodyEl.style.paddingBottom = '0';

            // ---- 13. Atualizar <title> ----
            const titleEl = doc.querySelector('title');
            if (titleEl) titleEl.textContent = 'Lucca Tuelher | Portfolio';

            // ---- 14. Serializar e download ----
            const serializer = new XMLSerializer();
            let html = '<!DOCTYPE html>\n' + doc.documentElement.outerHTML;

            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'portfolio-publico.html';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // Remove blocos de CSS marcados como editor-only do texto do style
        function stripEditorCSS(css) {
            // Remove entre os marcadores /* EDITOR-ONLY-START */ … /* EDITOR-ONLY-END */
            return css.replace(/\/\* EDITOR-ONLY-START \*\/[\s\S]*?\/\* EDITOR-ONLY-END \*\//g, '');
        }

        // Script mínimo para o site público: navegação, lightbox, contadores, lang
        function buildPublicScript() {
            // Inject minimal CSS for free blocks (static, no editor chrome)
            const freeBlockCSS = `
        .free-block { position:absolute; z-index:100; }
        .fb-text .fb-content { padding:16px 18px; line-height:1.6; color:var(--ink); overflow:auto; }
        .fb-image .fb-content { height:100%; overflow:hidden; }
        .fb-image .fb-content img { width:100%; height:100%; object-fit:cover; display:block; }
        .fb-toolbar, .fb-resize { display:none !important; }`;

            return `
        (function() {
            // Inject free-block static styles
            var s = document.createElement('style');
            s.textContent = ${JSON.stringify(freeBlockCSS)};
            document.head.appendChild(s);
            // ---- Estado ----
            var currentLang = 'pt';
            var previousView = 'home';

            var views = {
                home:     document.getElementById('home-view'),
                projects: document.getElementById('projects-view'),
                blog:     document.getElementById('blog-view'),
                gallery:  document.getElementById('gallery-view'),
                detail:   document.getElementById('detail-view'),
                contact:  document.getElementById('contact-view')
            };
            var navs = {
                work:     document.getElementById('nav-work'),
                projects: document.getElementById('nav-projects'),
                blog:     document.getElementById('nav-blog'),
                gallery:  document.getElementById('nav-gallery'),
                contact:  document.getElementById('nav-contact')
            };

            // ---- Lang ----
            window.setLang = function(lang) {
                currentLang = lang;
                document.body.className = 'lang-' + lang;
            };

            // ---- Views ----
            function resetViews() {
                Object.values(views).forEach(function(v) { if(v) v.classList.add('hidden'); });
                Object.values(navs).forEach(function(n) { if(n) n.classList.remove('active'); });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function showView(key, navKey) {
                resetViews();
                if (views[key]) {
                    views[key].classList.remove('hidden');
                    views[key].classList.add('fade-in');
                    setTimeout(function(){ views[key].classList.remove('fade-in'); }, 500);
                }
                if (navKey && navs[navKey]) navs[navKey].classList.add('active');
                updateMobileNav();
                window.scrollTo(0, 0);
            }

            // ---- Mobile menu ----
            function updateMobileNav() {
                var activeNav = document.querySelector('nav .nav-link.active');
                var activeId = activeNav ? activeNav.id.replace('nav-', '') : 'work';
                document.querySelectorAll('[data-mobile-nav]').forEach(function(a) {
                    a.classList.toggle('active', a.dataset.mobileNav === activeId);
                });
            }

            window.toggleMobileMenu = function() {
                var overlay = document.getElementById('mobile-nav-overlay');
                var drawer = document.getElementById('mobile-nav-drawer');
                if (drawer.classList.contains('open')) { closeMobileMenu(); return; }
                overlay.style.display = 'block';
                drawer.style.display = 'flex';
                requestAnimationFrame(function() { overlay.classList.add('open'); drawer.classList.add('open'); });
                document.body.style.overflow = 'hidden';
            };
            window.closeMobileMenu = function() {
                var overlay = document.getElementById('mobile-nav-overlay');
                var drawer = document.getElementById('mobile-nav-drawer');
                overlay.classList.remove('open');
                drawer.classList.remove('open');
                document.body.style.overflow = '';
                setTimeout(function() { overlay.style.display = 'none'; }, 300);
            };

            window.goHome    = function() { showView('home',     'work');     previousView = 'home';     renderFeatured(); };\n            window.goProjects= function() { showView('projects', 'projects'); previousView = 'projects'; };\n            window.goBlog    = function() { showView('blog',     'blog');     previousView = 'blog'; };\n            window.goGallery = function() { showView('gallery',  'gallery');  previousView = 'gallery'; };\n            window.goToContact = function() { showView('contact', 'contact'); };\n\n            window.goBack = function() {\n                if (previousView === 'blog')         goBlog();\n                else if (previousView === 'gallery')  goGallery();\n                else if (previousView === 'projects') goProjects();\n                else goHome();\n            };\n\n            // ---- Featured sections (title+subtitle | thumb, SpeakerDeck + 3 images) ----\n            function renderFeatured() {\n                var sectionsEl = document.getElementById('featured-sections');\n                if (!sectionsEl) return;\n                var allCards = Array.from(document.querySelectorAll('#public-grid .project-card'));\n                var featured = allCards.filter(function(c) { return c.dataset.featured === 'true'; });\n                var toShow = featured.length > 0 ? featured : allCards.slice(0, 3);\n                sectionsEl.innerHTML = '';\n                toShow.forEach(function(card, idx) {\n                    var id       = card.dataset.itemId;\n                    var thumb    = card.querySelector('.card-thumb');\n                    var thumbSrc = thumb ? thumb.src : '';\n                    var titlePT  = (card.querySelector('.card-title.pt-only') || {textContent:''}).textContent.trim() || 'Projeto';\n                    var titleEN  = (card.querySelector('.card-title.en-only') || {textContent:''}).textContent.trim() || 'Project';\n                    var tagPT    = (card.querySelector('.card-tag.pt-only')   || {textContent:''}).textContent.trim();\n                    var tagEN    = (card.querySelector('.card-tag.en-only')   || {textContent:''}).textContent.trim();\n                    var sdSrc    = card.dataset.sdSrc || '';\n                    var num      = String(idx + 1).padStart(2, '0');\n                    var previewImgs = [];\n                    try { previewImgs = JSON.parse(card.dataset.previewImgs || '[]'); } catch(e2) {}\n                    while (previewImgs.length < 3) previewImgs.push('');\n                    var ph = 'https://via.placeholder.com/400x300/e8e4db/a09c93';\n                    var imgItems = previewImgs.map(function(src, i) {\n                        return '<div class=\"hps-img-item\" data-proj-id=\"' + id + '\" data-img-idx=\"' + i + '\"><img src=\"' + (src || ph) + '\" class=\"hps-preview-img\" alt=\"\"></div>';\n                    }).join('');\n                    var embedContent = sdSrc\n                        ? '<iframe src=\"' + sdSrc + '\" allowfullscreen scrolling=\"no\" allow=\"autoplay; fullscreen\"></iframe>'\n                        : '<div class=\"hps-embed-placeholder\"><div style=\"font-size:1.4rem;margin-bottom:8px;opacity:0.3;\">&#9654;</div></div>';\n                    var section = document.createElement('div');\n                    section.className = 'home-proj-section';\n                    section.dataset.itemId = id;\n                    section.innerHTML =\n                        '<div class=\"hps-top\">' +\n                        '<div class=\"hps-left\">' +\n                        '<div class=\"hps-index\">' + num + '</div>' +\n                        '<div class=\"hps-tag pt-only\">' + tagPT + '</div>' +\n                        '<div class=\"hps-tag en-only\">' + tagEN + '</div>' +\n                        '<div class=\"hps-title pt-only\">' + titlePT + '</div>' +\n                        '<div class=\"hps-title en-only\">' + titleEN + '</div>' +\n                        '</div>' +\n                        '</div>' +\n                        '<div class=\"hps-embed-wrap\"><div class=\"hps-embed-label\">SpeakerDeck / Embed</div><div class=\"hps-embed\">' + embedContent + '</div></div>' +\n                        '<div class=\"hps-images\">' + imgItems + '</div>' +\n                        '<div class=\"hps-footer\"><a class=\"hps-link\" data-item-id=\"' + id + '\"><span class=\"pt-only\">Ver projeto \u2192</span><span class=\"en-only\">View project \u2192</span></a></div>';\n                    sectionsEl.appendChild(section);\n                });\n            }

            window.openItem = function(id) {
                var contentDiv = document.getElementById('detail-content');
                var source     = document.getElementById('data-' + id);
                if (!source) return;
                resetViews();
                views.detail.classList.remove('hidden');
                contentDiv.innerHTML = '';
                source.classList.remove('hidden');
                contentDiv.appendChild(source);
            };

            // ---- Lightbox ----
            window.openLightbox = function(src) {
                document.getElementById('lightbox-img').src = src;
                document.getElementById('lightbox').classList.add('open');
            };
            window.closeLightbox = function() {
                document.getElementById('lightbox').classList.remove('open');
            };
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeLightbox();
            });

            // ---- Sketch lightbox ----
            function attachSketchHandlers() {
                document.querySelectorAll('.sketch-item img').forEach(function(img) {
                    img.onclick = function() { openLightbox(img.src); };
                });
            }

            // ---- Counts ----
            function updateCounts() {
                var apc = document.getElementById('all-proj-count');
                var sc  = document.getElementById('sketch-count');
                var bc  = document.getElementById('blog-count');
                var an = document.querySelectorAll('#public-grid .project-card').length;
                var sn = document.querySelectorAll('#sketch-grid .sketch-item').length;
                var bn = document.querySelectorAll('#blog-grid-container .blog-item').length;
                if (apc) apc.textContent = an > 0 ? String(an).padStart(2,'0') : '—';
                if (sc)  sc.textContent  = sn > 0 ? String(sn).padStart(2,'0') : '—';
                if (bc)  bc.textContent  = bn > 0 ? String(bn).padStart(2,'0') : '—';
            }

            // ---- Click delegation for cards & home sections ----
            document.addEventListener('click', function(e) {
                var card = e.target.closest('.project-card[data-item-id], .blog-item[data-item-id]');
                if (card) { openItem(card.dataset.itemId); return; }
                var hpsLink = e.target.closest('.hps-link[data-item-id]');
                if (hpsLink) { openItem(hpsLink.dataset.itemId); return; }
                var hpsRight = e.target.closest('.hps-right');
                if (hpsRight) { var sec = hpsRight.closest('.home-proj-section[data-item-id]'); if (sec) openItem(sec.dataset.itemId); }
            });

            // ---- Init ----
            attachSketchHandlers();
            updateCounts();
            renderFeatured();
            goHome();
        })();
            `;
        }

        // ============================================
        // SAVE / BACKUP (editor — salva o editor completo)
        // ============================================
        function downloadSite() {
            // Now just saves to localStorage — no file download needed
            autoSave();
            const btn = document.getElementById('btn-save');
            if (btn) {
                const orig = btn.innerHTML;
                btn.innerHTML = '✓ Salvo';
                btn.style.background = '#3a8a3a';
                btn.style.borderColor = '#3a8a3a';
                setTimeout(() => { btn.innerHTML = orig; btn.style.background = ''; btn.style.borderColor = ''; }, 1800);
            }
        }

        function exportJSON() {
            const data = {
                version: 2,
                exported: new Date().toISOString(),
                publicGrid: document.getElementById('public-grid').innerHTML,
                privateGrid: document.getElementById('private-grid').innerHTML,
                blogGrid: document.getElementById('blog-grid-container').innerHTML,
                artGrid: document.getElementById('art-gallery-container').innerHTML,
                sketchGrid: document.getElementById('sketch-grid').innerHTML,
                hiddenData: Array.from(document.querySelectorAll('body > div[id^="data-"]')).map(el => el.outerHTML).join('')
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'portfolio_backup_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        function importJSON() {
            document.getElementById('json-input').click();
        }

        document.getElementById('json-input').addEventListener('change', function (e) {
            if (!e.target.files[0]) return;
            const reader = new FileReader();
            reader.onload = ev => {
                try {
                    const data = JSON.parse(ev.target.result);
                    document.getElementById('public-grid').innerHTML = data.publicGrid || '';
                    document.getElementById('private-grid').innerHTML = data.privateGrid || '';
                    document.getElementById('blog-grid-container').innerHTML = data.blogGrid || '';
                    document.getElementById('art-gallery-container').innerHTML = data.artGrid || '';
                    document.getElementById('sketch-grid').innerHTML = data.sketchGrid || '';

                    // Remove old hidden data
                    document.querySelectorAll('body > div[id^="data-"]').forEach(el => el.remove());

                    // Restore hidden data
                    if (data.hiddenData) {
                        const temp = document.createElement('div');
                        temp.innerHTML = data.hiddenData;
                        Array.from(temp.children).forEach(child => document.body.appendChild(child));
                    }

                    // Re-attach sketch lightbox handlers
                    if (window.attachSketchHandlers) attachSketchHandlers();

                    updateCounts();
                    alert("✓ Dados restaurados com sucesso!");
                } catch (err) {
                    alert("Erro ao importar: " + err.message);
                }
            };
            reader.readAsText(e.target.files[0]);
            this.value = '';
        });

        // ============================================
        // GIST SYNC
        // ============================================

        const GIST_STORAGE_KEY = 'portfolio_gist_config';
        const GIST_FILENAME     = 'portfolio_data.json';

        // --- Helpers ---

        function syncSetStatus(msg, type = 'info') {
            const el = document.getElementById('sync-status');
            el.textContent = msg;
            el.className = 'sync-status visible ' + type;
        }

        function syncSetDot(state) {
            // state: 'synced' | 'pending' | 'error' | ''
            const dot = document.getElementById('sync-dot');
            if (dot) dot.className = 'sync-dot ' + state;
        }

        function setSyncBtnsDisabled(disabled) {
            document.getElementById('btn-push').disabled = disabled;
            document.getElementById('btn-pull').disabled = disabled;
        }

        function formatDate(iso) {
            if (!iso) return '—';
            return new Date(iso).toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' });
        }

        function formatSize(bytes) {
            if (bytes < 1024)       return bytes + ' B';
            if (bytes < 1048576)    return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1048576).toFixed(2) + ' MB';
        }

        function collectData() {
            const freeBlocks = {};
            ['home-view','projects-view','blog-view','gallery-view','private-view','detail-view','contact-view'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const blocks = Array.from(el.querySelectorAll(':scope > .free-block'));
                if (blocks.length) {
                    freeBlocks[id] = blocks.map(b => ({
                        type:       b.dataset.type,
                        left:       b.style.left,
                        top:        b.style.top,
                        width:      b.style.width,
                        height:     b.style.height,
                        html:       b.querySelector('.fb-content')?.innerHTML || '',
                        fontSize:   b.querySelector('.fb-content')?.style.fontSize || '',
                        fontFamily: b.querySelector('.fb-content')?.style.fontFamily || '',
                        imgSrc:     b.querySelector('img')?.src || ''
                    }));
                }
            });

            return {
                version: 4,
                exported:    new Date().toISOString(),
                publicGrid:  document.getElementById('public-grid').innerHTML,
                privateGrid: document.getElementById('private-grid').innerHTML,
                blogGrid:    document.getElementById('blog-grid-container').innerHTML,
                artGrid:     document.getElementById('art-gallery-container').innerHTML,
                sketchGrid:  document.getElementById('sketch-grid').innerHTML,
                hiddenData:  Array.from(document.querySelectorAll('body > div[id^="data-"]'))
                                  .map(el => el.outerHTML).join(''),
                freeBlocks
            };
        }

        function applyData(data) {
            document.getElementById('public-grid').innerHTML           = data.publicGrid  || '';
            document.getElementById('private-grid').innerHTML          = data.privateGrid || '';
            document.getElementById('blog-grid-container').innerHTML   = data.blogGrid    || '';
            document.getElementById('art-gallery-container').innerHTML = data.artGrid     || '';
            document.getElementById('sketch-grid').innerHTML           = data.sketchGrid  || '';

            document.querySelectorAll('body > div[id^="data-"]').forEach(el => el.remove());
            if (data.hiddenData) {
                const temp = document.createElement('div');
                temp.innerHTML = data.hiddenData;
                Array.from(temp.children).forEach(child => document.body.appendChild(child));
            }

            if (data.freeBlocks) {
                document.querySelectorAll('.free-block').forEach(b => b.remove());
                Object.entries(data.freeBlocks).forEach(([viewId, blocks]) => {
                    const view = document.getElementById(viewId);
                    if (!view) return;
                    blocks.forEach(bd => _restoreFreeBlock(view, bd));
                });
            }

            // Restore sketch lightbox handlers
            if (window.attachSketchHandlers) attachSketchHandlers();

            // Restore star states
            const featured = getFeaturedIds();
            document.querySelectorAll('.star-btn').forEach(btn => {
                const card = btn.closest('.project-card');
                if (card && featured.includes(card.dataset.itemId)) {
                    btn.classList.add('star-on');
                    btn.title = 'Remover destaque';
                }
            });

            renderFeatured();
            updateCounts();
        }

        function _restoreFreeBlock(view, bd) {
            const block = document.createElement('div');
            block.className = 'free-block fb-' + bd.type;
            block.dataset.type = bd.type;
            block.style.left   = bd.left;
            block.style.top    = bd.top;
            block.style.width  = bd.width;
            block.style.height = bd.height;

            const toolbar = document.createElement('div');
            toolbar.className = 'fb-toolbar';
            toolbar.innerHTML = `
                <span class="fb-tool fb-drag-handle" title="Arrastar">⠿</span>
                ${bd.type === 'text' ? `
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-fmt" data-cmd="bold"><b>B</b></button>
                <button class="fb-tool fb-fmt" data-cmd="italic"><i>I</i></button>
                <button class="fb-tool fb-fmt" data-cmd="underline"><u>U</u></button>
                <span class="fb-tool fb-sep"></span>
                <select class="fb-tool fb-size">
                    <option value="0.8rem">XS</option>
                    <option value="1rem">S</option>
                    <option value="1.3rem">M</option>
                    <option value="1.8rem">L</option>
                    <option value="2.6rem">XL</option>
                    <option value="3.6rem">XXL</option>
                </select>
                <select class="fb-tool fb-font">
                    <option value="var(--sans)">Sans</option>
                    <option value="var(--serif)">Serif</option>
                    <option value="var(--mono)">Mono</option>
                </select>
                ` : `
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-img-upload">🖼 Trocar</button>
                `}
                <span class="fb-tool fb-sep"></span>
                <button class="fb-tool fb-del">✕</button>`;

            const content = document.createElement('div');
            content.className = 'fb-content';

            if (bd.type === 'text') {
                content.contentEditable = 'true';
                content.innerHTML = bd.html || '';
                if (bd.fontSize)   content.style.fontSize   = bd.fontSize;
                if (bd.fontFamily) content.style.fontFamily = bd.fontFamily;
                content.addEventListener('mousedown', e => e.stopPropagation());
            } else {
                const img = document.createElement('img');
                img.src = bd.imgSrc || 'https://via.placeholder.com/480x300/e8e4db/a09c93';
                img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;';
                content.appendChild(img);
                content.style.height = '100%';
            }

            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'fb-resize';
            resizeHandle.innerHTML = '⤡';

            block.appendChild(toolbar);
            block.appendChild(content);
            block.appendChild(resizeHandle);

            // Re-attach events
            block.addEventListener('mousedown', function(e) {
                if (e.target.closest('.fb-toolbar') || e.target.closest('.fb-resize')) return;
                deselectAllBlocks();
                block.classList.add('fb-selected');
                _fbSelected = block;
            });

            toolbar.querySelector('.fb-drag-handle').addEventListener('mousedown', function(e) {
                e.preventDefault();
                deselectAllBlocks();
                block.classList.add('fb-selected');
                _fbDragging = block;
                const r = block.getBoundingClientRect();
                _fbOx = e.clientX - r.left;
                _fbOy = e.clientY - r.top;
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'grabbing';
            });

            resizeHandle.addEventListener('mousedown', function(e) {
                e.preventDefault();
                e.stopPropagation();
                _fbResizing = block;
                _fbOw  = block.offsetWidth;
                _fbOh  = block.offsetHeight;
                _fbOmx = e.clientX;
                _fbOmy = e.clientY;
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'nwse-resize';
            });

            toolbar.querySelector('.fb-del').addEventListener('click', function(e) {
                e.stopPropagation();
                if (confirm('Excluir este bloco?')) block.remove();
            });

            if (bd.type === 'text') {
                toolbar.querySelectorAll('.fb-fmt').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        content.focus();
                        document.execCommand(this.dataset.cmd, false, null);
                    });
                });
                const sizeEl = toolbar.querySelector('.fb-size');
                if (sizeEl) {
                    sizeEl.value = bd.fontSize || '1rem';
                    sizeEl.addEventListener('change', function() { content.style.fontSize = this.value; });
                }
                const fontEl = toolbar.querySelector('.fb-font');
                if (fontEl) {
                    fontEl.value = bd.fontFamily || 'var(--sans)';
                    fontEl.addEventListener('change', function() { content.style.fontFamily = this.value; });
                }
            } else {
                toolbar.querySelector('.fb-img-upload').addEventListener('click', function(e) {
                    e.stopPropagation();
                    currentImg = content.querySelector('img');
                    document.getElementById('file-input').click();
                });
            }

            view.style.position = 'relative';
            view.appendChild(block);
            return block;
        }

        // --- Persistence ---

        function loadSyncConfig() {
            try {
                return JSON.parse(localStorage.getItem(GIST_STORAGE_KEY)) || {};
            } catch { return {}; }
        }

        function saveSyncConfig(cfg) {
            localStorage.setItem(GIST_STORAGE_KEY, JSON.stringify(cfg));
        }

        // --- Modal open/close ---

        function openSyncModal() {
            const cfg = loadSyncConfig();

            // Populate fields
            if (cfg.token)  document.getElementById('gist-token').value = cfg.token;
            if (cfg.gistId) document.getElementById('gist-id').value    = cfg.gistId;

            // Populate info
            document.getElementById('info-last-push').textContent = formatDate(cfg.lastPush);
            document.getElementById('info-last-pull').textContent = formatDate(cfg.lastPull);
            document.getElementById('info-gist-id').textContent   = cfg.gistId
                ? cfg.gistId.slice(0, 8) + '...'
                : '—';

            // Data size estimate
            const raw = JSON.stringify(collectData());
            document.getElementById('info-data-size').textContent = formatSize(new Blob([raw]).size);

            // Clear status
            document.getElementById('sync-status').className = 'sync-status';

            document.getElementById('sync-modal-backdrop').classList.add('open');
        }

        function closeSyncModal() {
            document.getElementById('sync-modal-backdrop').classList.remove('open');
        }

        // Close on backdrop click
        document.getElementById('sync-modal-backdrop').addEventListener('click', function(e) {
            if (e.target === this) closeSyncModal();
        });

        // --- Push ---

        async function gistPush() {
            const token  = document.getElementById('gist-token').value.trim();
            const gistId = document.getElementById('gist-id').value.trim();

            if (!token) {
                syncSetStatus('⚠ Insira o GitHub Token antes de continuar.', 'err');
                return;
            }

            setSyncBtnsDisabled(true);
            syncSetDot('pending');
            syncSetStatus('Enviando dados…', 'info');

            const payload = JSON.stringify(collectData(), null, 2);

            try {
                let res, json;

                const body = {
                    description: 'Portfolio Lucca Tuelher — sync ' + new Date().toISOString(),
                    public: false,
                    files: { [GIST_FILENAME]: { content: payload } }
                };

                if (gistId) {
                    // Update existing Gist (PATCH)
                    res = await fetch(`https://api.github.com/gists/${gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                            'X-GitHub-Api-Version': '2022-11-28'
                        },
                        body: JSON.stringify(body)
                    });
                } else {
                    // Create new Gist (POST)
                    res = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                            'X-GitHub-Api-Version': '2022-11-28'
                        },
                        body: JSON.stringify(body)
                    });
                }

                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    throw new Error(`GitHub API ${res.status}: ${err.message || res.statusText}`);
                }

                json = await res.json();
                const newId = json.id;

                // Save config
                const now = new Date().toISOString();
                const cfg = loadSyncConfig();
                cfg.token    = token;
                cfg.gistId   = newId;
                cfg.lastPush = now;
                saveSyncConfig(cfg);

                // Update UI
                document.getElementById('gist-id').value              = newId;
                document.getElementById('info-gist-id').textContent   = newId.slice(0, 8) + '...';
                document.getElementById('info-last-push').textContent = formatDate(now);

                syncSetDot('synced');
                syncSetStatus(
                    `✓ Push concluído!\nGist ID: ${newId}\nURL: ${json.html_url}`,
                    'ok'
                );

            } catch (err) {
                syncSetDot('error');
                syncSetStatus('✕ Erro: ' + err.message, 'err');
                console.error('[Gist Push]', err);
            } finally {
                setSyncBtnsDisabled(false);
            }
        }

        // --- Pull ---

        async function gistPull() {
            const token  = document.getElementById('gist-token').value.trim();
            const gistId = document.getElementById('gist-id').value.trim();

            if (!token)  { syncSetStatus('⚠ Insira o GitHub Token.', 'err'); return; }
            if (!gistId) { syncSetStatus('⚠ Insira o Gist ID para fazer pull.', 'err'); return; }

            setSyncBtnsDisabled(true);
            syncSetDot('pending');
            syncSetStatus('Buscando dados do Gist…', 'info');

            try {
                const res = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'X-GitHub-Api-Version': '2022-11-28'
                    }
                });

                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    throw new Error(`GitHub API ${res.status}: ${err.message || res.statusText}`);
                }

                const gist = await res.json();
                const file = gist.files[GIST_FILENAME];

                if (!file) {
                    throw new Error(`Arquivo "${GIST_FILENAME}" não encontrado no Gist. Verifique o ID.`);
                }

                // Gist may truncate large files — fetch raw if needed
                let rawContent = file.content;
                if (file.truncated) {
                    syncSetStatus('Arquivo grande, buscando conteúdo completo…', 'info');
                    const rawRes = await fetch(file.raw_url, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!rawRes.ok) throw new Error('Falha ao buscar raw_url: ' + rawRes.status);
                    rawContent = await rawRes.text();
                }

                const data = JSON.parse(rawContent);

                if (!confirm(`Isso vai substituir todo o conteúdo atual pelo do Gist.\nÚltima edição: ${data.exported || 'desconhecido'}\n\nContinuar?`)) {
                    syncSetStatus('Pull cancelado.', 'info');
                    setSyncBtnsDisabled(false);
                    syncSetDot('');
                    return;
                }

                applyData(data);

                // Save config
                const now = new Date().toISOString();
                const cfg = loadSyncConfig();
                cfg.token    = token;
                cfg.gistId   = gistId;
                cfg.lastPull = now;
                saveSyncConfig(cfg);

                document.getElementById('info-last-pull').textContent = formatDate(now);

                syncSetDot('synced');
                syncSetStatus(
                    `✓ Pull concluído! Dados de ${formatDate(data.exported)} aplicados.`,
                    'ok'
                );

            } catch (err) {
                syncSetDot('error');
                syncSetStatus('✕ Erro: ' + err.message, 'err');
                console.error('[Gist Pull]', err);
            } finally {
                setSyncBtnsDisabled(false);
            }
        }

        function initSyncDot() {
            const cfg = loadSyncConfig();
            if (cfg.gistId && cfg.lastPush) syncSetDot('synced');
        }

        // ============================================
        // AUTO-SAVE TO LOCALSTORAGE
        // ============================================
        const LS_KEY = 'portfolio_autosave';

        function autoSave() {
            setEditorStatus('saving');
            try {
                const data = collectData();

                // Static editable text
                data._staticText = {};
                document.querySelectorAll('[data-save-id]').forEach(el => {
                    data._staticText[el.dataset.saveId] = el.innerHTML;
                });

                // Home YouTube embed
                data._homeYT = document.querySelector('.home-yt-wrap .edit-embed iframe')?.src || null;

                // Bottom banner image
                data._bottomBannerImg = document.querySelector('.bottom-banner-img')?.src || null;

                // SpeakerDeck embeds per card
                data._sdEmbeds = {};
                document.querySelectorAll('#public-grid .project-card[data-item-id]').forEach(card => {
                    if (card.dataset.sdSrc) data._sdEmbeds[card.dataset.itemId] = card.dataset.sdSrc;
                });

                // Preview images (3 per card)
                data._previewImgs = {};
                document.querySelectorAll('#public-grid .project-card[data-item-id]').forEach(card => {
                    if (card.dataset.previewImgs) data._previewImgs[card.dataset.itemId] = card.dataset.previewImgs;
                });

                localStorage.setItem(LS_KEY, JSON.stringify(data));
                setEditorStatus('saved');
            } catch(e) { setEditorStatus('error'); console.warn('AutoSave failed:', e); }
        }

        function autoLoad() {
            try {
                const raw = localStorage.getItem(LS_KEY);
                if (!raw) return false;
                const data = JSON.parse(raw);
                applyData(data);

                // Restore static text
                if (data._staticText) {
                    Object.entries(data._staticText).forEach(([id, html_]) => {
                        const el = document.querySelector(`[data-save-id="${id}"]`);
                        if (el) el.innerHTML = html_;
                    });
                }

                // Restore home YouTube embed
                if (data._homeYT) {
                    const ytEl = document.querySelector('.home-yt-wrap .edit-embed');
                    if (ytEl) ytEl.innerHTML = `<iframe src="${data._homeYT}" allowfullscreen></iframe>`;
                }
                // Legacy: old saves used _homeEmbed
                if (!data._homeYT && data._homeEmbed) {
                    const ytEl = document.querySelector('.home-yt-wrap .edit-embed');
                    if (ytEl) ytEl.innerHTML = `<iframe src="${data._homeEmbed}" allowfullscreen></iframe>`;
                }

                // Restore bottom banner image
                if (data._bottomBannerImg) {
                    const bbImg = document.querySelector('.bottom-banner-img');
                    if (bbImg) bbImg.src = data._bottomBannerImg;
                }

                // Restore SD embeds on cards
                if (data._sdEmbeds) {
                    Object.entries(data._sdEmbeds).forEach(([projId, src]) => {
                        const card = document.querySelector(`#public-grid .project-card[data-item-id="${projId}"]`);
                        if (card) card.dataset.sdSrc = src;
                    });
                }

                // Restore preview images on cards
                if (data._previewImgs) {
                    Object.entries(data._previewImgs).forEach(([projId, imgs]) => {
                        const card = document.querySelector(`#public-grid .project-card[data-item-id="${projId}"]`);
                        if (card) card.dataset.previewImgs = imgs;
                    });
                }

                // Re-render home sections (picks up SD + preview images)
                renderFeatured();

                // Re-restore static text that lives inside rendered featured-sections
                if (data._staticText) {
                    Object.entries(data._staticText).forEach(([id, html_]) => {
                        const el = document.querySelector(`[data-save-id="${id}"]`);
                        if (el) el.innerHTML = html_;
                    });
                }

                return true;
            } catch(e) { console.warn('AutoLoad failed:', e); return false; }
        }

        function startAutoSaveObserver() {
            const targets = ['home-view','projects-view','blog-view','gallery-view','private-view','contact-view'];
            const observer = new MutationObserver(() => {
                clearTimeout(window._autoSaveTimer);
                window._autoSaveTimer = setTimeout(autoSave, 800);
            });
            targets.forEach(id => {
                const el = document.getElementById(id);
                if (el) observer.observe(el, { childList: true, subtree: true, characterData: true });
            });
            observer.observe(document.body, { childList: true });
        }

        // ============================================
        // DEVICE MODE TOGGLE (Desktop ↔ Mobile preview)
        // ============================================
        let currentDeviceMode = 'desktop';

        function setDeviceMode(mode) {
            if (mode === currentDeviceMode) return;
            currentDeviceMode = mode;

            const body = document.body;
            const container = document.querySelector('body > .container') || document.querySelector('.phone-frame-scroll > .container');
            const phoneScroll = document.getElementById('phone-frame-scroll');
            const dtDesktop = document.getElementById('dt-desktop');
            const dtMobile = document.getElementById('dt-mobile');

            if (mode === 'mobile') {
                // Move container into phone frame
                if (container && container.parentElement !== phoneScroll) {
                    phoneScroll.appendChild(container);
                }
                body.classList.add('force-mobile');
                dtDesktop.classList.remove('dt-active');
                dtMobile.classList.add('dt-active');
            } else {
                // Move container back to body (before phone-frame)
                if (container && container.parentElement === phoneScroll) {
                    const phoneFrame = document.getElementById('phone-frame');
                    body.insertBefore(container, phoneFrame);
                }
                body.classList.remove('force-mobile');
                dtDesktop.classList.add('dt-active');
                dtMobile.classList.remove('dt-active');
            }

            // Re-run view init to ensure correct state
            if (isEditing) {
                enableEditing(true);
            }
        }

        // Auto-detect: if real viewport is mobile-sized, default to mobile
        (function autoDetectDevice() {
            if (window.innerWidth <= 680) {
                // Actually on mobile — hide toggle, no need to force
                return;
            }
        })();

        // ============================================
        // MOBILE MENU
        // ============================================
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobile-nav-overlay');
            const drawer = document.getElementById('mobile-nav-drawer');
            const isOpen = drawer.classList.contains('open');
            if (isOpen) {
                closeMobileMenu();
            } else {
                overlay.style.display = 'block';
                drawer.style.display = 'flex';
                requestAnimationFrame(() => {
                    overlay.classList.add('open');
                    drawer.classList.add('open');
                });
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMobileMenu() {
            const overlay = document.getElementById('mobile-nav-overlay');
            const drawer = document.getElementById('mobile-nav-drawer');
            overlay.classList.remove('open');
            drawer.classList.remove('open');
            document.body.style.overflow = '';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
        }

        // Update mobile nav active state
        function updateMobileNav() {
            const active = document.querySelector('nav .nav-link.active');
            const activeId = active ? active.id.replace('nav-', '') : 'work';
            document.querySelectorAll('[data-mobile-nav]').forEach(a => {
                a.classList.toggle('active', a.dataset.mobileNav === activeId);
            });
        }

        // Patch navigation functions to update mobile nav
        const _origGoHome = typeof goHome === 'function' ? goHome : null;
        const _origGoProjects = typeof goProjects === 'function' ? goProjects : null;
        const _origGoGallery = typeof goGallery === 'function' ? goGallery : null;
        const _origGoBlog = typeof goBlog === 'function' ? goBlog : null;
        const _origGoToContact = typeof goToContact === 'function' ? goToContact : null;

        // Will be patched after nav functions are defined via MutationObserver
        const _patchMobileNav = () => {
            const origShow = window.showView;
            if (origShow) {
                // The nav updates happen in showView or similar
            }
            // Just poll active nav state
            setTimeout(updateMobileNav, 100);
        };

        // Listen for nav changes to sync mobile nav
        new MutationObserver(_patchMobileNav).observe(
            document.querySelector('nav') || document.body,
            { attributes: true, subtree: true, attributeFilter: ['class'] }
        );

        // ============================================
        // MOBILE EDITOR ACTIONS
        // ============================================
        function openMobileEditorActions() {
            const overlay = document.getElementById('mea-overlay');
            const drawer = document.getElementById('mea-drawer');
            overlay.style.display = 'block';
            requestAnimationFrame(() => {
                overlay.classList.add('open');
                drawer.classList.add('open');
            });
        }

        function closeMobileEditorActions() {
            const overlay = document.getElementById('mea-overlay');
            const drawer = document.getElementById('mea-drawer');
            overlay.classList.remove('open');
            drawer.classList.remove('open');
            setTimeout(() => { overlay.style.display = 'none'; }, 300);
        }

        // ============================================
        // TOUCH SUPPORT FOR FREE BLOCKS
        // ============================================
        (function setupTouchBlocks() {
            let _touchBlock = null, _touchMode = null;
            let _tOx = 0, _tOy = 0, _tOw = 0, _tOh = 0, _tOmx = 0, _tOmy = 0;

            document.addEventListener('touchstart', function(e) {
                if (!isEditing) return;
                const handle = e.target.closest('.fb-drag-handle');
                const resize = e.target.closest('.fb-resize');
                if (handle) {
                    const block = handle.closest('.free-block');
                    if (!block) return;
                    e.preventDefault();
                    _touchBlock = block;
                    _touchMode = 'drag';
                    deselectAllBlocks();
                    block.classList.add('fb-selected');
                    const r = block.getBoundingClientRect();
                    const t = e.touches[0];
                    _tOx = t.clientX - r.left;
                    _tOy = t.clientY - r.top;
                } else if (resize) {
                    const block = resize.closest('.free-block');
                    if (!block) return;
                    e.preventDefault();
                    _touchBlock = block;
                    _touchMode = 'resize';
                    _tOw = block.offsetWidth;
                    _tOh = block.offsetHeight;
                    const t = e.touches[0];
                    _tOmx = t.clientX;
                    _tOmy = t.clientY;
                }
            }, { passive: false });

            document.addEventListener('touchmove', function(e) {
                if (!_touchBlock) return;
                e.preventDefault();
                const t = e.touches[0];
                if (_touchMode === 'drag') {
                    const view = _touchBlock.closest('[id$="-view"], [id^="detail-content"]');
                    if (!view) return;
                    const vr = view.getBoundingClientRect();
                    let x = t.clientX - _tOx - vr.left;
                    let y = t.clientY - _tOy - vr.top + view.scrollTop;
                    x = Math.max(0, x);
                    y = Math.max(0, y);
                    _touchBlock.style.left = x + 'px';
                    _touchBlock.style.top = y + 'px';
                } else if (_touchMode === 'resize') {
                    const dx = t.clientX - _tOmx;
                    const dy = t.clientY - _tOmy;
                    const nw = Math.max(120, _tOw + dx);
                    const nh = Math.max(60, _tOh + dy);
                    _touchBlock.style.width = nw + 'px';
                    if (_touchBlock.dataset.type !== 'text') {
                        _touchBlock.style.height = nh + 'px';
                    }
                }
            }, { passive: false });

            document.addEventListener('touchend', function() {
                _touchBlock = null;
                _touchMode = null;
            });
        })();

        // ============================================
        // RUN
        // ============================================
        init();
        initSyncDot();
        autoLoad();
        startAutoSaveObserver();
    </script>
</body>
</html>
